<!doctype html>
<html lang="en">
  <head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="desk9solutions,business,company,agency,multipurpose,modern,bootstrap4">
  
  <meta name="author" content="desk9solutions.com">

  <title>Desk9 Solutions</title>

  <!-- bootstrap.min css -->
  <link rel="stylesheet" href="plugins/bootstrap/css/bootstrap.min.css">
  <!-- Icon Font Css -->
  <link rel="stylesheet" href="plugins/themify/css/themify-icons.css">
  <link rel="stylesheet" href="plugins/fontawesome/css/all.css">
  <link rel="stylesheet" href="plugins/magnific-popup/dist/magnific-popup.css">
  <!-- Owl Carousel CSS -->
  <link rel="stylesheet" href="plugins/slick-carousel/slick/slick.css">
  <link rel="stylesheet" href="plugins/slick-carousel/slick/slick-theme.css">

  <!-- Main Stylesheet -->
  <link rel="stylesheet" href="css/style.css">

</head>

<body>

<!-- Header Start --> 

<header class="navigation">
	 
	<nav class="navbar navbar-expand-lg  py-4" id="navbar">
		<div class="container">
		  <a class="navbar-brand" href="index.html">
			<img style="height: 10vh; object-fit: cover;" src="images/bg/desk9-logo.png" alt="logo">
		  </a>

		  <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#navbarsExample09" aria-controls="navbarsExample09" aria-expanded="false" aria-label="Toggle navigation">
			<span class="fa fa-bars"></span>
		  </button>
	  
		  <div class="collapse navbar-collapse text-center" id="navbarsExample09">
			<ul class="navbar-nav ml-auto">
			  <li class="nav-item active">
				<a class="nav-link" href="index.html">Home <span class="sr-only">(current)</span></a>
			  </li>
			  <li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle" href="#" id="dropdown03" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">About</a>
					<ul class="dropdown-menu" aria-labelledby="dropdown03">
						<li><a class="dropdown-item" href="about.html">Our company</a></li>
												<li><a class="dropdown-item" href="whyus.html">Why us</a></li>

					</ul>
			  </li>
			   <li class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle"
                  href="#"
                  id="dropdown03"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="false"
                  >Services</a
                >
                <ul class="dropdown-menu" aria-labelledby="dropdown03">
                  <li>
                    <a class="dropdown-item" href="service.html">Solutions</a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="training.html">Trainings</a>
                  </li>
                </ul>
              </li>

              <li class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle"
                  href="#"
                  id="dropdown03"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="false"
                  >Resources</a
                >
                <ul class="dropdown-menu" aria-labelledby="dropdown03">
                  <li>
                    <a class="dropdown-item" href="blog-grid.html">Blog</a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="video.html">Videos</a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="white-paper.html"
                      >White Papers</a
                    >
                  </li>
                </ul>
              </li>
			   
			   
			   <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
			</ul>


		  </div>
		</div>
	</nav>
</header>

<!-- Header Close --> 

<div class="main-wrapper ">
<section class="page-title bg-1">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="block text-center">
          <span class="text-white">News details</span>
          <h1 class="text-capitalize mb-4 text-lg">Blog Single</h1>
          <ul class="list-inline">
            <li class="list-inline-item"><a href="index.html" class="text-white">Home</a></li>
            <li class="list-inline-item"><span class="text-white">/</span></li>
            <li class="list-inline-item"><a href="#" class="text-white-50">News details</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</section>



<section class="section blog-wrap bg-gray">
    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                <div class="row">
	<div class="col-lg-12 mb-5">
		<div class="single-blog-item">
			<img src="images/blog/2.jpg" alt="" class="img-fluid rounded">

			<div class="blog-item-content bg-white p-5">
				<div class="blog-item-meta bg-gray py-1 px-2">
					<span class="text-muted text-capitalize mr-3"><i class="ti-pencil-alt mr-2"></i>Creativity</span>
					<span class="text-muted text-capitalize mr-3"><i class="ti-comment mr-2"></i>5 Comments</span>
					<span class="text-black text-capitalize mr-3"><i class="ti-time mr-1"></i> 28th January</span>
				</div> 
<article class="lazy-article ph3 pt0 pb4 mw7 center"><h1 class="navy tc f2 f1-ns">Tracing the path of network traffic in Kubernetes</h1><p class="f7 black-60 tc ttu">Published in January 2022</p><hr class="pv2 bn"><div class="aspect-ratio aspect-ratio--6x4"><img src="https://learnk8s.io/a/5d15e769b507e18545fba977032fb0f0.svg" class="aspect-ratio--object" alt="Tracing the path of network traffic in Kubernetes"></div><hr class="w3 center b--navy mv4 mb5-ns"><p class="lh-copy measure-wide f4"><strong class="b">TL;DR:</strong> <em class="i">In this article, you will learn how packets flow inside and outside a Kubernetes cluster. Starting from the initial web request and down to the container hosting the application.</em></p><h2 class="f2 pt5 pb2 mt3" id="table-of-contents">Table of Contents</h2><ul><li class="lh-copy f4 mv1 measure-wide"><a href="#table-of-contents" target="_self" class="link navy underline hover-sky">Table of Contents</a></li><li class="lh-copy f4 mv1 measure-wide"><a href="#kubernetes-networking-requirements" target="_self" class="link navy underline hover-sky">Kubernetes networking requirements</a></li><li class="lh-copy f4 mv1 measure-wide"><a href="#how-linux-network-namespaces-work-in-a-pod" target="_self" class="link navy underline hover-sky">How Linux network namespaces work in a pod</a></li><li class="lh-copy f4 mv1 measure-wide"><a href="#the-pause-container-creates-the-network-namespace-in-the-pod" target="_self" class="link navy underline hover-sky">The pause container creates the network namespace in the pod</a></li><li class="lh-copy f4 mv1 measure-wide"><a href="#the-pod-is-assigned-a-single-ip-address" target="_self" class="link navy underline hover-sky">The pod is assigned a single IP address</a></li><li class="lh-copy f4 mv1 measure-wide"><a href="#inspecting-pod-to-pod-traffic-in-the-cluster" target="_self" class="link navy underline hover-sky">Inspecting pod to pod traffic in the cluster</a></li><li class="lh-copy f4 mv1 measure-wide"><a href="#the-pod-network-namespace-is-connected-to-an-ethernet-bridge" target="_self" class="link navy underline hover-sky">The Pod network namespace is connected to an ethernet bridge</a></li><li class="lh-copy f4 mv1 measure-wide"><a href="#tracing-pod-to-pod-traffic-on-the-same-node" target="_self" class="link navy underline hover-sky">Tracing pod to pod traffic on the same node</a></li><li class="lh-copy f4 mv1 measure-wide"><a href="#tracing-pod-to-pod-communication-on-different-nodes" target="_self" class="link navy underline hover-sky">Tracing pod to pod communication on different nodes</a></li><li class="lh-copy f4 mv1 measure-wide"><a href="#the-container-network-interface-cni" target="_self" class="link navy underline hover-sky">The Container Network Interface - CNI</a></li><li class="lh-copy f4 mv1 measure-wide"><a href="#inspecting-pod-to-service-traffic" target="_self" class="link navy underline hover-sky">Inspecting pod to service traffic</a></li><li class="lh-copy f4 mv1 measure-wide"><a href="#intercepting-and-rewriting-traffic-with-netfilter-and-iptables" target="_self" class="link navy underline hover-sky">Intercepting and rewriting traffic with Netfilter and Iptables</a></li><li class="lh-copy f4 mv1 measure-wide"><a href="#inspecting-responses-from-services" target="_self" class="link navy underline hover-sky">Inspecting responses from services</a></li></ul><h2 class="f2 pt5 pb2 mt3" id="kubernetes-networking-requirements">Kubernetes networking requirements</h2><p class="lh-copy measure-wide f4">Before diving into the details on how packets flow inside a Kubernetes cluster, let's first clear up the requirements for a Kubernetes network.</p><p class="lh-copy measure-wide f4">The Kubernetes networking model defines a set of fundamental rules:</p><ul><li class="lh-copy f4 mv1 measure-wide"><strong class="b">A pod in the cluster should be able to freely communicate with any other pod</strong> without the use of Network Address Translation (NAT).</li><li class="lh-copy f4 mv1 measure-wide"><strong class="b">Any program running on a cluster node should communicate with any pod</strong> on the same node without using NAT.</li><li class="lh-copy f4 mv1 measure-wide"><strong class="b">Each pod has its own IP address</strong> (IP-per-Pod), and every other pod can reach it at that same address.</li></ul><p class="lh-copy measure-wide f4">Those requirements don't restrict the implementation to a single solution.</p><p class="lh-copy measure-wide f4">Instead, they describe the properties of the cluster network in general terms.</p><p class="lh-copy measure-wide f4">In satisfying those constraints, you will have to solve the <a href="https://github.com/kubernetes/community/blob/master/contributors/design-proposals/network/networking.md" target="_blank" rel="noreferrer" class="link navy underline hover-sky">following challenges:</a></p><ol><li class="lh-copy f4 mv1 measure-wide"><em class="i">How do you make sure that containers in the same pod behave as if they are on the same host?</em></li><li class="lh-copy f4 mv1 measure-wide"><em class="i">Can the pod reach other pods in the cluster?</em></li><li class="lh-copy f4 mv1 measure-wide"><em class="i">Can the pod reach services? And are the services load balancing requests?</em></li><li class="lh-copy f4 mv1 measure-wide"><em class="i">Can the pod receive traffic external to the cluster?</em></li></ol><p class="lh-copy measure-wide f4">In this article, you will focus on the first three points, starting with intra-pod networking or container-to-container communication.</p><h2 class="f2 pt5 pb2 mt3" id="how-linux-network-namespaces-work-in-a-pod">How Linux network namespaces work in a pod</h2><p class="lh-copy measure-wide f4">Let's consider a main container hosting the application and another running alongside it.</p><p class="lh-copy measure-wide f4">In this example, you have a pod with an Nginx container and another with busybox:</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div><p class="code f6 mv0 black-60 w-100 tc absolute top-0 left-0 h1 pv2">pod.yaml</p></header><pre class="code-light-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="standard"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> multi<span class="token punctuation">-</span>container<span class="token punctuation">-</span>pod
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> container<span class="token punctuation">-</span><span class="token number">1</span>
</span><span class="highlight">      <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
</span><span class="standard">      <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'/bin/sh'</span><span class="token punctuation">,</span> <span class="token string">'-c'</span><span class="token punctuation">,</span> <span class="token string">'sleep 1d'</span><span class="token punctuation">]</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> container<span class="token punctuation">-</span><span class="token number">2</span>
</span><span class="highlight">      <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx</span></code></pre></div><p class="lh-copy measure-wide f4">When deployed, the following things happen:</p><ol><li class="lh-copy f4 mv1 measure-wide">The pod gets <strong class="b">its own network namespace</strong> on the node.</li><li class="lh-copy f4 mv1 measure-wide"><strong class="b">An IP address is assigned</strong> to the pod, and the ports are shared between the two containers.</li><li class="lh-copy f4 mv1 measure-wide"><strong class="b">Both containers share the same networking namespace</strong> and can see each other on localhost.</li></ol><p class="lh-copy measure-wide f4">The network configuration happens lightning fast in the background.</p><p class="lh-copy measure-wide f4">However, let's take a step back and try to understand <em class="i">why</em> the above is needed for containers to run.</p><p class="lh-copy measure-wide f4"><a href="https://iximiuz.com/en/posts/container-networking-is-simple/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">In Linux, the network namespaces are separate, isolated, logical spaces.</a></p><p class="lh-copy measure-wide f4">You can think of network namespaces as taking the physical network interface and slicing it into smaller independent parts.</p><p class="lh-copy measure-wide f4">Each part can be configured separately and with its own networking rules and resources.</p><p class="lh-copy measure-wide f4">Those can range from firewall rules, interfaces (virtual or physical), routes, and everything else networking-related.</p><div class="relative overflow-hidden"><ul class="pl0 list"><li class="mv3"><input type="radio" name="carousel-1" id="carousel-1-0" checked="" class="o-0 absolute bottom-0 left-0"><div class="dn checked-reveal"><div class="aspect-ratio aspect-ratio--4x3"><img src="https://learnk8s.io/a/941e6d55d9aac9cc43e964ad102e9391.svg" alt="The physical network interface holds the root network namespace." class="aspect-ratio--object" loading="lazy"></div><div class="bt b-solid bw2 b--black-70 relative mt0"><div class="bg-black-10 br1 pa1 dib mt2 absolute bottom-1 left-0 z-999"><span class="b black-60">1</span><span class="f7 black-50">/2</span></div></div><div class="flex items-start justify-between bg-evian ph2"><div class="w-20"></div><div class="f5 lh-copy black-90 w-60 center"><p class="lh-copy measure-wide f5">The physical network interface holds the root network namespace.</p></div><label class="db f6 b black-50 pv3 pointer w-20 tr ttu" for="carousel-1-1">Next <svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon ml2"><polyline fill="none" vector-effect="non-scaling-stroke" points="2,2 8,8 2,14"></polyline></svg></label></div></div></li><li class="mv3"><input type="radio" name="carousel-1" id="carousel-1-1" class="o-0 absolute bottom-0 left-0"><div class="dn checked-reveal"><div class="aspect-ratio aspect-ratio--4x3"><img src="https://learnk8s.io/a/45d5de36a76aa86a898eb1ffb94e55b3.svg" alt="You can use Linux network namespaces to create isolated networks. Each network is independent and doesn't talk to the others unless you configure it to." class="aspect-ratio--object" loading="lazy"></div><div class="bt b-solid bw2 b--black-70 relative mt0"><div class="bg-black-10 br1 pa1 dib mt2 absolute bottom-1 left-0 z-999"><span class="b black-60">2</span><span class="f7 black-50">/2</span></div></div><div class="flex items-start justify-between bg-evian ph2"><label class="db f6 b black-50 pv3 pointer w-20 ttu" for="carousel-1-0"><svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon mr2"><polyline fill="none" vector-effect="non-scaling-stroke" points="8,2 2,8 8,14"></polyline></svg> Previous</label><div class="f5 lh-copy black-90 w-60 center"><p class="lh-copy measure-wide f5">You can use Linux network namespaces to create isolated networks. Each network is independent and doesn't talk to the others unless you configure it to.</p></div><div class="w-20"></div></div></div></li></ul></div><p class="lh-copy measure-wide f4">The physical interface has to process all the <em class="i">real</em> packets in the end, so all virtual interfaces are created from that.</p><p class="lh-copy measure-wide f4">The network namespaces can be managed by the <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">ip-netns</code> <a href="https://man7.org/linux/man-pages/man8/ip-netns.8.html" target="_blank" rel="noreferrer" class="link navy underline hover-sky">management tool</a>, and you can use <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">ip netns list</code> to list the namespaces on a host.</p><blockquote class="pl3 mh2 bl bw2 b--blue bg-evian pv1 ph4"><p class="lh-copy measure-wide f4">Please note that when a network namespace is created, it will be present under <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">/var/run/netns</code> but <a href="https://www.packetcoders.io/how-to-view-the-network-namespaces-in-kubernetes/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">Docker doesn't always respect that.</a></p></blockquote><p class="lh-copy measure-wide f4">For example, these are namespaces from a Kubernetes node:</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div><p class="code f6 mv0 black-60 w-100 tc absolute top-0 left-0 h1 pv2">bash</p></header><pre class="code-dark-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="command prompt"><span class="token function">ip</span> netns list
</span><span class="output">cni-0f226515-e28b-df13-9f16-dd79456825ac <span class="token punctuation">(</span>id: <span class="token number">3</span><span class="token punctuation">)</span>
cni-4e4dfaac-89a6-2034-6098-dd8b2ee51dcd <span class="token punctuation">(</span>id: <span class="token number">4</span><span class="token punctuation">)</span>
cni-7e94f0cc-9ee8-6a46-178a-55c73ce58f2e <span class="token punctuation">(</span>id: <span class="token number">2</span><span class="token punctuation">)</span>
cni-7619c818-5b66-5d45-91c1-1c516f559291 <span class="token punctuation">(</span>id: <span class="token number">1</span><span class="token punctuation">)</span>
cni-3004ec2c-9ac2-2928-b556-82c7fb37a4d8 <span class="token punctuation">(</span>id: <span class="token number">0</span><span class="token punctuation">)</span></span><span class="output prompt mt3 empty"></span></code></pre></div><blockquote class="pl3 mh2 bl bw2 b--blue bg-evian pv1 ph4"><p class="lh-copy measure-wide f4">Notice the <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">cni-</code> prefix; this means that the namespace creation has been taken care of by a CNI.</p></blockquote><p class="lh-copy measure-wide f4">When you create a pod, and that pod gets assigned to a node, the <a href="https://github.com/containernetworking/cni#what-is-cni" target="_blank" rel="noreferrer" class="link navy underline hover-sky">CNI</a> will:</p><ol><li class="lh-copy f4 mv1 measure-wide">Assign an IP address.</li><li class="lh-copy f4 mv1 measure-wide">Attach the container(s) to the network.</li></ol><p class="lh-copy measure-wide f4">If the pod contains multiple containers like above, both containers are put in the same namespace.</p><div class="relative overflow-hidden"><ul class="pl0 list"><li class="mv3"><input type="radio" name="carousel-2" id="carousel-2-0" checked="" class="o-0 absolute bottom-0 left-0"><div class="dn checked-reveal"><div class="aspect-ratio aspect-ratio--4x3"><img src="https://learnk8s.io/a/f240df957191a80f14f3dff4e03a1f04.svg" alt="When you create a pod, first the container runtime creates a network namespace for the containers." class="aspect-ratio--object" loading="lazy"></div><div class="bt b-solid bw2 b--black-70 relative mt0"><div class="bg-black-10 br1 pa1 dib mt2 absolute bottom-1 left-0 z-999"><span class="b black-60">1</span><span class="f7 black-50">/3</span></div></div><div class="flex items-start justify-between bg-evian ph2"><div class="w-20"></div><div class="f5 lh-copy black-90 w-60 center"><p class="lh-copy measure-wide f5">When you create a pod, first the container runtime creates a network namespace for the containers.</p></div><label class="db f6 b black-50 pv3 pointer w-20 tr ttu" for="carousel-2-1">Next <svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon ml2"><polyline fill="none" vector-effect="non-scaling-stroke" points="2,2 8,8 2,14"></polyline></svg></label></div></div></li><li class="mv3"><input type="radio" name="carousel-2" id="carousel-2-1" class="o-0 absolute bottom-0 left-0"><div class="dn checked-reveal"><div class="aspect-ratio aspect-ratio--4x3"><img src="https://learnk8s.io/a/4a24a4a646939d95aff02cfd1d7b7ae2.svg" alt="Then, the CNI takes lead and assigns it an IP address." class="aspect-ratio--object" loading="lazy"></div><div class="bt b-solid bw2 b--black-70 relative mt0"><div class="bg-black-10 br1 pa1 dib mt2 absolute bottom-1 left-0 z-999"><span class="b black-60">2</span><span class="f7 black-50">/3</span></div></div><div class="flex items-start justify-between bg-evian ph2"><label class="db f6 b black-50 pv3 pointer w-20 ttu" for="carousel-2-0"><svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon mr2"><polyline fill="none" vector-effect="non-scaling-stroke" points="8,2 2,8 8,14"></polyline></svg> Previous</label><div class="f5 lh-copy black-90 w-60 center"><p class="lh-copy measure-wide f5">Then, the CNI takes lead and assigns it an IP address.</p></div><label class="db f6 b black-50 pv3 pointer w-20 tr ttu" for="carousel-2-2">Next <svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon ml2"><polyline fill="none" vector-effect="non-scaling-stroke" points="2,2 8,8 2,14"></polyline></svg></label></div></div></li><li class="mv3"><input type="radio" name="carousel-2" id="carousel-2-2" class="o-0 absolute bottom-0 left-0"><div class="dn checked-reveal"><div class="aspect-ratio aspect-ratio--4x3"><img src="https://learnk8s.io/a/963c7aa880a953445bed849882e720ae.svg" alt="And finally the CNI attaches the containers to the rest of the network." class="aspect-ratio--object" loading="lazy"></div><div class="bt b-solid bw2 b--black-70 relative mt0"><div class="bg-black-10 br1 pa1 dib mt2 absolute bottom-1 left-0 z-999"><span class="b black-60">3</span><span class="f7 black-50">/3</span></div></div><div class="flex items-start justify-between bg-evian ph2"><label class="db f6 b black-50 pv3 pointer w-20 ttu" for="carousel-2-1"><svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon mr2"><polyline fill="none" vector-effect="non-scaling-stroke" points="8,2 2,8 8,14"></polyline></svg> Previous</label><div class="f5 lh-copy black-90 w-60 center"><p class="lh-copy measure-wide f5">And finally the CNI attaches the containers to the rest of the network.</p></div><div class="w-20"></div></div></div></li></ul></div><p class="lh-copy measure-wide f4"><em class="i">So what happens when you list the containers on a node?</em></p><p class="lh-copy measure-wide f4">You can SSH into a Kubernetes node and explore the namespaces:</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div><p class="code f6 mv0 black-60 w-100 tc absolute top-0 left-0 h1 pv2">bash</p></header><pre class="code-dark-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="command prompt">lsns -t net
</span><span class="output">        NS TYPE NPROCS   PID <span class="token environment constant">USER</span>     NETNSID NSFS                           COMMAND
<span class="token number">4026531992</span> net     <span class="token number">171</span>     <span class="token number">1</span> root  unassigned /run/docker/netns/default      /sbin/init noembed norestore
<span class="token number">4026532286</span> net       <span class="token number">2</span>  <span class="token number">4808</span> <span class="token number">65535</span>          <span class="token number">0</span> /run/docker/netns/56c020051c3b /pause
<span class="token number">4026532414</span> net       <span class="token number">5</span>  <span class="token number">5489</span> <span class="token number">65535</span>          <span class="token number">1</span> /run/docker/netns/7db647b9b187 /pause</span><span class="output prompt mt3 empty"></span></code></pre></div><p class="lh-copy measure-wide f4">Where <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">lsns</code> is a command for listing <em class="i">all</em> available namespaces on a host.</p><blockquote class="pl3 mh2 bl bw2 b--blue bg-evian pv1 ph4"><p class="lh-copy measure-wide f4">Keep in mind that there are <a href="https://man7.org/linux/man-pages/man7/namespaces.7.html" target="_blank" rel="noreferrer" class="link navy underline hover-sky">multiple namespace types</a> in Linux.</p></blockquote><p class="lh-copy measure-wide f4"><em class="i">Where is the Nginx container?</em></p><p class="lh-copy measure-wide f4"><em class="i">What are those <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">pause</code> containers?</em></p><h2 class="f2 pt5 pb2 mt3" id="the-pause-container-creates-the-network-namespace-in-the-pod">The pause container creates the network namespace in the pod</h2><p class="lh-copy measure-wide f4">Let's list all the processes on the node and check if we can find the Nginx container:</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div><p class="code f6 mv0 black-60 w-100 tc absolute top-0 left-0 h1 pv2">bash</p></header><pre class="code-dark-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="command prompt">lsns
</span><span class="output">        NS TYPE   NPROCS   PID <span class="token environment constant">USER</span>            COMMAND
<span class="token comment"># truncated output</span>
<span class="token number">4026532414</span> net         <span class="token number">5</span>  <span class="token number">5489</span> <span class="token number">65535</span>           /pause
<span class="token number">4026532513</span> mnt         <span class="token number">1</span>  <span class="token number">5599</span> root            <span class="token function">sleep</span> 1d
<span class="token number">4026532514</span> uts         <span class="token number">1</span>  <span class="token number">5599</span> root            <span class="token function">sleep</span> 1d
<span class="token number">4026532515</span> pid         <span class="token number">1</span>  <span class="token number">5599</span> root            <span class="token function">sleep</span> 1d
</span><span class="output highlight"><span class="token number">4026532516</span> mnt         <span class="token number">3</span>  <span class="token number">5777</span> root            nginx: master process nginx -g daemon off<span class="token punctuation">;</span>
<span class="token number">4026532517</span> uts         <span class="token number">3</span>  <span class="token number">5777</span> root            nginx: master process nginx -g daemon off<span class="token punctuation">;</span>
<span class="token number">4026532518</span> pid         <span class="token number">3</span>  <span class="token number">5777</span> root            nginx: master process nginx -g daemon off<span class="token punctuation">;</span></span><span class="output prompt mt3 empty"></span></code></pre></div><p class="lh-copy measure-wide f4">The container is listed in the mount (<code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">mnt</code>), Unix time-sharing (<code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">uts</code>) and PID (<code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">pid</code>) namespace, but not in the networking namespace (<code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">net</code>).</p><p class="lh-copy measure-wide f4">Unfortunately, <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">lsns</code> only shows the lowest PID for each process, but you can further filter based on the process ID.</p><p class="lh-copy measure-wide f4">You can retrieve all namespaces for the Nginx container with:</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div><p class="code f6 mv0 black-60 w-100 tc absolute top-0 left-0 h1 pv2">bash</p></header><pre class="code-dark-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="command prompt"><span class="token function">sudo</span> lsns -p <span class="token number">5777</span>
</span><span class="output">       NS TYPE   NPROCS   PID <span class="token environment constant">USER</span>  COMMAND
<span class="token number">4026531835</span> cgroup    <span class="token number">178</span>     <span class="token number">1</span> root  /sbin/init noembed norestore
<span class="token number">4026531837</span> user      <span class="token number">178</span>     <span class="token number">1</span> root  /sbin/init noembed norestore
</span><span class="output highlight"><span class="token number">4026532411</span> ipc         <span class="token number">5</span>  <span class="token number">5489</span> <span class="token number">65535</span> /pause
<span class="token number">4026532414</span> net         <span class="token number">5</span>  <span class="token number">5489</span> <span class="token number">65535</span> /pause
</span><span class="output"><span class="token number">4026532516</span> mnt         <span class="token number">3</span>  <span class="token number">5777</span> root  nginx: master process nginx -g daemon off<span class="token punctuation">;</span>
<span class="token number">4026532517</span> uts         <span class="token number">3</span>  <span class="token number">5777</span> root  nginx: master process nginx -g daemon off<span class="token punctuation">;</span>
<span class="token number">4026532518</span> pid         <span class="token number">3</span>  <span class="token number">5777</span> root  nginx: master process nginx -g daemon off<span class="token punctuation">;</span></span><span class="output prompt mt3 empty"></span></code></pre></div><p class="lh-copy measure-wide f4">The <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">pause</code> process again, and this time it's holding the network namespace hostage.</p><p class="lh-copy measure-wide f4"><em class="i">What is that?</em></p><p class="lh-copy measure-wide f4"><strong class="b">Every pod in the cluster has an additional hidden container running in the background called <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">pause</code>.</strong></p><p class="lh-copy measure-wide f4">If you list the containers running on a node and grab the pause containers:</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div><p class="code f6 mv0 black-60 w-100 tc absolute top-0 left-0 h1 pv2">bash</p></header><pre class="code-dark-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="output"><span class="token function">docker</span> <span class="token function">ps</span> <span class="token operator">|</span> <span class="token function">grep</span> pause
fa9666c1d9c6   k8s.gcr.io/pause:3.4.1  <span class="token string">"/pause"</span>  k8s_POD_kube-dns-599484b884-sv2js…
44218e010aeb   k8s.gcr.io/pause:3.4.1  <span class="token string">"/pause"</span>  k8s_POD_blackbox-exporter-55c457d…
5fb4b5942c66   k8s.gcr.io/pause:3.4.1  <span class="token string">"/pause"</span>  k8s_POD_kube-dns-599484b884-cq99x…
8007db79dcf2   k8s.gcr.io/pause:3.4.1  <span class="token string">"/pause"</span>  k8s_POD_konnectivity-agent-84f87c…</span><span class="output prompt mt3 empty"></span></code></pre></div><p class="lh-copy measure-wide f4">You will see that for each assigned pod on the node, a <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">pause</code> container is automatically paired with it.</p><p class="lh-copy measure-wide f4"><strong class="b">This <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">pause</code> container is responsible for creating and holding the network namespace.</strong></p><p class="lh-copy measure-wide f4"><em class="i">Creating the namespace?</em></p><p class="lh-copy measure-wide f4">Yes and no.</p><p class="lh-copy measure-wide f4">The network namespace creation is done by <a href="https://www.aquasec.com/cloud-native-academy/container-security/container-runtime/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">the underlaying container runtime</a>. Usually <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">containerd</code> or <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">CRI-O</code>.</p><p class="lh-copy measure-wide f4">Just before the pod is deployed and container created, (among other things) it's the runtime responsibility to create the network namespace.</p><p class="lh-copy measure-wide f4">Instead of running <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">ip netns</code> and creating the network namespace manually, the container runtime does this automatically. </p><p class="lh-copy measure-wide f4">Back to the pause container.</p><p class="lh-copy measure-wide f4">It contains very little code and instantly goes to sleep as soon as deployed.</p><p class="lh-copy measure-wide f4">However, <a href="https://www.ianlewis.org/en/almighty-pause-container" target="_blank" rel="noreferrer" class="link navy underline hover-sky">it is essential and plays a crucial role in the Kubernetes ecosystem.</a></p><div class="relative overflow-hidden"><ul class="pl0 list"><li class="mv3"><input type="radio" name="carousel-3" id="carousel-3-0" checked="" class="o-0 absolute bottom-0 left-0"><div class="dn checked-reveal"><div class="aspect-ratio aspect-ratio--4x3"><img src="https://learnk8s.io/a/201510ad30f9ae89515be0d79f35e597.svg" alt="When you create a pod, the container runtime creates a network namespace with a sleep container." class="aspect-ratio--object" loading="lazy"></div><div class="bt b-solid bw2 b--black-70 relative mt0"><div class="bg-black-10 br1 pa1 dib mt2 absolute bottom-1 left-0 z-999"><span class="b black-60">1</span><span class="f7 black-50">/3</span></div></div><div class="flex items-start justify-between bg-evian ph2"><div class="w-20"></div><div class="f5 lh-copy black-90 w-60 center"><p class="lh-copy measure-wide f5">When you create a pod, the container runtime creates a network namespace with a <em class="i">sleep</em> container.</p></div><label class="db f6 b black-50 pv3 pointer w-20 tr ttu" for="carousel-3-1">Next <svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon ml2"><polyline fill="none" vector-effect="non-scaling-stroke" points="2,2 8,8 2,14"></polyline></svg></label></div></div></li><li class="mv3"><input type="radio" name="carousel-3" id="carousel-3-1" class="o-0 absolute bottom-0 left-0"><div class="dn checked-reveal"><div class="aspect-ratio aspect-ratio--4x3"><img src="https://learnk8s.io/a/822de32c50f94cc5f439d84242a59a83.svg" alt="Every other container in the pod joins the existing network namespace created by this container." class="aspect-ratio--object" loading="lazy"></div><div class="bt b-solid bw2 b--black-70 relative mt0"><div class="bg-black-10 br1 pa1 dib mt2 absolute bottom-1 left-0 z-999"><span class="b black-60">2</span><span class="f7 black-50">/3</span></div></div><div class="flex items-start justify-between bg-evian ph2"><label class="db f6 b black-50 pv3 pointer w-20 ttu" for="carousel-3-0"><svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon mr2"><polyline fill="none" vector-effect="non-scaling-stroke" points="8,2 2,8 8,14"></polyline></svg> Previous</label><div class="f5 lh-copy black-90 w-60 center"><p class="lh-copy measure-wide f5">Every other container in the pod joins the existing network namespace created by this container.</p></div><label class="db f6 b black-50 pv3 pointer w-20 tr ttu" for="carousel-3-2">Next <svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon ml2"><polyline fill="none" vector-effect="non-scaling-stroke" points="2,2 8,8 2,14"></polyline></svg></label></div></div></li><li class="mv3"><input type="radio" name="carousel-3" id="carousel-3-2" class="o-0 absolute bottom-0 left-0"><div class="dn checked-reveal"><div class="aspect-ratio aspect-ratio--4x3"><img src="https://learnk8s.io/a/6400a5aa88f9ef3bdc165a1e2cfeb190.svg" alt="At this point, the CNI assigns the IP address and attaches the containers to the network." class="aspect-ratio--object" loading="lazy"></div><div class="bt b-solid bw2 b--black-70 relative mt0"><div class="bg-black-10 br1 pa1 dib mt2 absolute bottom-1 left-0 z-999"><span class="b black-60">3</span><span class="f7 black-50">/3</span></div></div><div class="flex items-start justify-between bg-evian ph2"><label class="db f6 b black-50 pv3 pointer w-20 ttu" for="carousel-3-1"><svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon mr2"><polyline fill="none" vector-effect="non-scaling-stroke" points="8,2 2,8 8,14"></polyline></svg> Previous</label><div class="f5 lh-copy black-90 w-60 center"><p class="lh-copy measure-wide f5">At this point, the CNI assigns the IP address and attaches the containers to the network.</p></div><div class="w-20"></div></div></div></li></ul></div><p class="lh-copy measure-wide f4"><em class="i">How can a container that goes to sleep be useful?</em></p><p class="lh-copy measure-wide f4">To understand its utility, let's imagine having a pod with two containers like in the previous example, but no <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">pause</code> container.</p><p class="lh-copy measure-wide f4">As soon as the container starts, the CNI:</p><ol><li class="lh-copy f4 mv1 measure-wide">Makes the busybox container join the previous network namespace.</li><li class="lh-copy f4 mv1 measure-wide">Assigns an IP address.</li><li class="lh-copy f4 mv1 measure-wide">Attaches the containers to the network.</li></ol><p class="lh-copy measure-wide f4"><em class="i">What happens if the Nginx crashes?</em></p><p class="lh-copy measure-wide f4">The CNI will have to go through all of the steps <em class="i">again</em> and the network will be disrupted for both containers.</p><p class="lh-copy measure-wide f4">Since it's unlikely that a <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">sleep</code> container can have any bug, it's usually a safer and more robust choice to create the network namespace.</p><p class="lh-copy measure-wide f4"><strong class="b">If one of the containers inside the pod crashes, the remaining can still reply to any network requests.</strong></p><h2 class="f2 pt5 pb2 mt3" id="the-pod-is-assigned-a-single-ip-address">The Pod is assigned a single IP address</h2><p class="lh-copy measure-wide f4">I mentioned that the pod and both containers receive the same IP.</p><p class="lh-copy measure-wide f4"><em class="i">How is that configured?</em></p><p class="lh-copy measure-wide f4"><strong class="b">Inside the pod network namespace, an interface is created, and an IP address is assigned.</strong></p><p class="lh-copy measure-wide f4">Let's verify that.</p><p class="lh-copy measure-wide f4">First, find the pod's IP address:</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div><p class="code f6 mv0 black-60 w-100 tc absolute top-0 left-0 h1 pv2">bash</p></header><pre class="code-dark-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="command prompt">kubectl get pod multi-container-pod -o <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token punctuation">{</span>.status.podIP<span class="token punctuation">}</span>
</span><span class="output"><span class="token number">10.244</span>.4.40</span><span class="output prompt mt3 empty"></span></code></pre></div><p class="lh-copy measure-wide f4">Next, let's find the relevant network namespace.</p><p class="lh-copy measure-wide f4">Since network namespaces are created from a physical interface, you will have to access the cluster node.</p><blockquote class="pl3 mh2 bl bw2 b--blue bg-evian pv1 ph4"><p class="lh-copy measure-wide f4">If you are running <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">minikube</code>, you can try <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">minikube ssh</code> to access the node. If you are running in a cloud provider, there should be some way to access the node over SSH.</p></blockquote><p class="lh-copy measure-wide f4">Once you are in, let's find the latest named network namespace that was created:</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div><p class="code f6 mv0 black-60 w-100 tc absolute top-0 left-0 h1 pv2">bash</p></header><pre class="code-dark-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="command prompt"><span class="token function">ls</span> -lt /var/run/netns
</span><span class="output">total <span class="token number">0</span>
</span><span class="output highlight">-r--r--r-- <span class="token number">1</span> root root <span class="token number">0</span> Sep <span class="token number">25</span> <span class="token number">13</span>:34 cni-0f226515-e28b-df13-9f16-dd79456825ac
</span><span class="output">-r--r--r-- <span class="token number">1</span> root root <span class="token number">0</span> Sep <span class="token number">24</span> 09:39 cni-4e4dfaac-89a6-2034-6098-dd8b2ee51dcd
-r--r--r-- <span class="token number">1</span> root root <span class="token number">0</span> Sep <span class="token number">24</span> 09:39 cni-7e94f0cc-9ee8-6a46-178a-55c73ce58f2e
-r--r--r-- <span class="token number">1</span> root root <span class="token number">0</span> Sep <span class="token number">24</span> 09:39 cni-7619c818-5b66-5d45-91c1-1c516f559291
-r--r--r-- <span class="token number">1</span> root root <span class="token number">0</span> Sep <span class="token number">24</span> 09:39 cni-3004ec2c-9ac2-2928-b556-82c7fb37a4d8</span><span class="output prompt mt3 empty"></span></code></pre></div><p class="lh-copy measure-wide f4">In this case it is <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">cni-0f226515-e28b-df13-9f16-dd79456825ac</code>.</p><p class="lh-copy measure-wide f4">Now you can run the <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">exec</code> command inside that namespace:</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div><p class="code f6 mv0 black-60 w-100 tc absolute top-0 left-0 h1 pv2">bash</p></header><pre class="code-dark-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="command prompt"><span class="token function">ip</span> netns <span class="token builtin class-name">exec</span> cni-0f226515-e28b-df13-9f16-dd79456825ac <span class="token function">ip</span> a
</span><span class="output"><span class="token comment"># output truncated</span>
</span><span class="output highlight"><span class="token number">3</span>: eth0@if12: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1450</span> qdisc noqueue state UP group default
    link/ether <span class="token number">16</span>:a4:f8:4f:56:77 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">0</span>
    inet <span class="token number">10.244</span>.4.40/32 brd <span class="token number">10.244</span>.4.40 scope global eth0
</span><span class="output">       valid_lft forever preferred_lft forever
    inet6 fe80::14a4:f8ff:fe4f:5677/64 scope <span class="token function">link</span>
       valid_lft forever preferred_lft forever</span><span class="output prompt mt3 empty"></span></code></pre></div><p class="lh-copy measure-wide f4"><strong class="b">That's the IP address of the pod!</strong></p><p class="lh-copy measure-wide f4">Let's find out the other end of that interface by grepping for the <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">12</code> part of <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">@if12</code>.</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div><p class="code f6 mv0 black-60 w-100 tc absolute top-0 left-0 h1 pv2">bash</p></header><pre class="code-dark-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="command prompt"><span class="token function">ip</span> <span class="token function">link</span> <span class="token operator">|</span> <span class="token function">grep</span> -A1 ^12
</span><span class="output"><span class="token number">12</span>: vethweplb3f36a0@if16: mtu <span class="token number">1376</span> qdisc noqueue master weave state UP mode DEFAULT group default
</span><span class="output highlight">    link/ether <span class="token number">72</span>:1c:73:d9:d9:f6 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">1</span></span><span class="output prompt mt3 empty"></span></code></pre></div><p class="lh-copy measure-wide f4">You can also verify that the Nginx container listens for HTTP traffic from within that namespace:</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div><p class="code f6 mv0 black-60 w-100 tc absolute top-0 left-0 h1 pv2">bash</p></header><pre class="code-dark-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="command prompt"><span class="token function">ip</span> netns <span class="token builtin class-name">exec</span> cni-0f226515-e28b-df13-9f16-dd79456825ac <span class="token function">netstat</span> -lnp
</span><span class="output">Active Internet connections <span class="token punctuation">(</span>only servers<span class="token punctuation">)</span>
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:80              <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">692698</span>/nginx: master
tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::80                   :::*                    LISTEN      <span class="token number">692698</span>/nginx: master</span><span class="output prompt mt3 empty"></span></code></pre></div><blockquote class="pl3 mh2 bl bw2 b--blue bg-evian pv1 ph4"><p class="lh-copy measure-wide f4">If you can't get SSH access to the worker nodes in your cluster, you can use <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">kubectl exec</code> to get a shell to the busybox container and use the <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">ip</code> and <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">netstat</code> command directly inside.</p></blockquote><p class="lh-copy measure-wide f4"><em class="i">Excellent!</em></p><p class="lh-copy measure-wide f4">Now that we covered the communication between the containers let's see how Pod-to-Pod communication is established.</p><h2 class="f2 pt5 pb2 mt3" id="inspecting-pod-to-pod-traffic-in-the-cluster">Inspecting pod to pod traffic in the cluster</h2><p class="lh-copy measure-wide f4">When Pod-to-Pod communication comes into question, there are two possible scenarios:</p><ol><li class="lh-copy f4 mv1 measure-wide">The pod traffic is destined to a pod on the same node.</li><li class="lh-copy f4 mv1 measure-wide">The pod traffic is destined to a pod that resides on a different node.</li></ol><p class="lh-copy measure-wide f4">For the whole setup to work, we need the virtual interface pairs that we've discussed and ethernet bridges.</p><p class="lh-copy measure-wide f4">Before moving forward, let's discuss their function and why they are necessary.</p><p class="lh-copy measure-wide f4"><strong class="b">For a pod to communicate to other pods, it must first have access to the node's root namespace.</strong></p><p class="lh-copy measure-wide f4">This is achieved using a virtual ethernet pair connecting the two namespaces: pod and root.</p><p class="lh-copy measure-wide f4">Those <a href="https://man7.org/linux/man-pages/man4/veth.4.html" target="_blank" rel="noreferrer" class="link navy underline hover-sky">virtual interface devices</a> (hence the <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">v</code> in <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">veth</code>) connect and act as a tunnel between the two namespaces.</p><p class="lh-copy measure-wide f4">With this <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">veth</code> device, you attach one end to the pod's namespace and the other to the root namespace.</p><img class="db pv3 center" src="https://learnk8s.io/a/6400a5aa88f9ef3bdc165a1e2cfeb190.svg" alt="The virtual interface devices in a pod connect the pod's namespace to the root's network namespace." loading="lazy"><p class="lh-copy measure-wide f4">The CNI does this for you, but you could also do this manually with:</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div><p class="code f6 mv0 black-60 w-100 tc absolute top-0 left-0 h1 pv2">bash</p></header><pre class="code-dark-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="command prompt active"><span class="token function">ip</span> <span class="token function">link</span> <span class="token function">add</span> veth1 netns pod-namespace <span class="token builtin class-name">type</span> veth peer veth2 netns root</span></code></pre></div><p class="lh-copy measure-wide f4">Now your pod's namespace has an access "tunnel" to the root namespace.</p><p class="lh-copy measure-wide f4"><strong class="b">Each newly created pod on the node will be set up with a <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">veth</code> pair like this.</strong></p><p class="lh-copy measure-wide f4">Creating the interface pairs is one part.</p><p class="lh-copy measure-wide f4">The other is assigning an address to the ethernet devices and creating the default routes.</p><p class="lh-copy measure-wide f4">Let's explore how to set up the <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">veth1</code> interface in the pod's namespace:</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div><p class="code f6 mv0 black-60 w-100 tc absolute top-0 left-0 h1 pv2">bash</p></header><pre class="code-dark-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="command prompt"><span class="token function">ip</span> netns <span class="token builtin class-name">exec</span> cni-0f226515-e28b-df13-9f16-dd79456825ac <span class="token function">ip</span> addr <span class="token function">add</span> <span class="token number">10.244</span>.4.40/24 dev veth1
</span><span class="command prompt"><span class="token function">ip</span> netns <span class="token builtin class-name">exec</span> cni-0f226515-e28b-df13-9f16-dd79456825ac <span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> veth1 up
</span><span class="command prompt active"><span class="token function">ip</span> netns <span class="token builtin class-name">exec</span> cni-0f226515-e28b-df13-9f16-dd79456825ac <span class="token function">ip</span> route <span class="token function">add</span> default via <span class="token number">10.244</span>.4.40</span></code></pre></div><p class="lh-copy measure-wide f4">On the node side, let's create the other <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">veth2</code> pair:</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div><p class="code f6 mv0 black-60 w-100 tc absolute top-0 left-0 h1 pv2">bash</p></header><pre class="code-dark-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="command prompt"><span class="token function">ip</span> addr <span class="token function">add</span> <span class="token number">169.254</span>.132.141/16 dev veth2
</span><span class="command prompt active"><span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> veth2 up</span></code></pre></div><p class="lh-copy measure-wide f4">You can inspect the existing <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">veth</code> pairs as you did previously.</p><p class="lh-copy measure-wide f4">In the pod's namespace, retrieve the suffix of the <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">eth0</code> interface.</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div><p class="code f6 mv0 black-60 w-100 tc absolute top-0 left-0 h1 pv2">bash</p></header><pre class="code-dark-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="command prompt"><span class="token function">ip</span> netns <span class="token builtin class-name">exec</span> cni-0f226515-e28b-df13-9f16-dd79456825ac <span class="token function">ip</span> <span class="token function">link</span> show <span class="token builtin class-name">type</span> veth
</span><span class="output"><span class="token number">3</span>: eth0@if12: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1450</span> qdisc noqueue state UP mode DEFAULT group default
    link/ether <span class="token number">16</span>:a4:f8:4f:56:77 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">0</span></span><span class="output prompt mt3 empty"></span></code></pre></div><p class="lh-copy measure-wide f4">In this case, you can grep for <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">grep -A1 ^12</code> (or just scroll through the output):</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div><p class="code f6 mv0 black-60 w-100 tc absolute top-0 left-0 h1 pv2">bash</p></header><pre class="code-dark-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="command prompt"><span class="token function">ip</span> <span class="token function">link</span> show <span class="token builtin class-name">type</span> veth
</span><span class="output"><span class="token comment"># output truncated</span>
<span class="token number">12</span>: cali97e50e215bd@if3: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1450</span> qdisc noqueue state UP mode DEFAULT group default
    link/ether ee:ee:ee:ee:ee:ee brd ff:ff:ff:ff:ff:ff link-netns cni-0f226515-e28b-df13-9f16-dd79456825ac</span><span class="output prompt mt3 empty"></span></code></pre></div><blockquote class="pl3 mh2 bl bw2 b--blue bg-evian pv1 ph4"><p class="lh-copy measure-wide f4">You can also use <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">ip -n cni-0f226515-e28b-df13-9f16-dd79456825ac link show type veth</code>.</p></blockquote><p class="lh-copy measure-wide f4">Pay attention to the notation on both <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">3: eth0@if12</code> and <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">12: cali97e50e215bd@if3</code> interfaces.</p><p class="lh-copy measure-wide f4">From the pod namespace, the <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">eth0</code> interface connects to interface number 12 in the root namespace. Hence the <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">@if12</code>.</p><p class="lh-copy measure-wide f4">On the other end of the <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">veth</code> pair, the root namespace is connected to the pod namespace interface number 3.</p><p class="lh-copy measure-wide f4">Next comes the bridge that will connect each end of the <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">veth</code> pairs.</p><h2 class="f2 pt5 pb2 mt3" id="the-pod-network-namespace-is-connected-to-an-ethernet-bridge">The pod network namespace is connected to an ethernet bridge</h2><p class="lh-copy measure-wide f4">The bridge will 'tie' together each end of the virtual interfaces located in the root namespace.</p><p class="lh-copy measure-wide f4"><strong class="b">This bridge will allow traffic to flow between virtual pairs and traverse through the common root namespace.</strong></p><p class="lh-copy measure-wide f4"><em class="i">Theory time.</em></p><p class="lh-copy measure-wide f4">An ethernet bridge is located at layer 2 of <a href="https://en.wikipedia.org/wiki/OSI_model" target="_blank" rel="noreferrer" class="link navy underline hover-sky">the OSI networking model.</a></p><p class="lh-copy measure-wide f4"><a href="https://ops.tips/blog/using-network-namespaces-and-bridge-to-isolate-servers/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">You can think of the bridge as a virtual switch accepting connections from different namespaces and interfaces.</a></p><p class="lh-copy measure-wide f4"><strong class="b">The ethernet bridge allows you to connect multiple available networks on the same node.</strong></p><p class="lh-copy measure-wide f4">So you can use this setup and bridge the two interfaces, the <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">veth</code> from the pod namespace to the other pod <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">veth</code> on the node.</p><img class="db pv3 center" src="https://learnk8s.io/a/72130856cd225fe326bccde12b524814.svg" alt="You can use the bridge to connect each end of the virtual interfaces" loading="lazy"><p class="lh-copy measure-wide f4">Let's have a look at ethernet bridge and veth pairs in action.</p><h2 class="f2 pt5 pb2 mt3" id="tracing-pod-to-pod-traffic-on-the-same-node">Tracing pod to pod traffic on the same node</h2><p class="lh-copy measure-wide f4">Let's assume there are two pods on the same node, and Pod-A wants to send a message to Pod-B.</p><div class="relative overflow-hidden"><ul class="pl0 list"><li class="mv3"><input type="radio" name="carousel-4" id="carousel-4-0" checked="" class="o-0 absolute bottom-0 left-0"><div class="dn checked-reveal"><div class="aspect-ratio aspect-ratio--4x3"><img src="https://learnk8s.io/a/91902010f7202b086f3e78260af25446.svg" alt="Since the destination isn't one of the containers in the namespace, Pod-A sends out a packet to its default interface eth0. This interface is tied to the one end of the veth pair and serves as a tunnel. With that, packets are forwarded to the root namespace on the node." class="aspect-ratio--object" loading="lazy"></div><div class="bt b-solid bw2 b--black-70 relative mt0"><div class="bg-black-10 br1 pa1 dib mt2 absolute bottom-1 left-0 z-999"><span class="b black-60">1</span><span class="f7 black-50">/5</span></div></div><div class="flex items-start justify-between bg-evian ph2"><div class="w-20"></div><div class="f5 lh-copy black-90 w-60 center"><p class="lh-copy measure-wide f5">Since the destination isn't one of the containers in the namespace, Pod-A sends out a packet to its default interface <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">eth0</code>. This interface is tied to the one end of the <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">veth</code> pair and serves as a tunnel. With that, packets are forwarded to the root namespace on the node.</p></div><label class="db f6 b black-50 pv3 pointer w-20 tr ttu" for="carousel-4-1">Next <svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon ml2"><polyline fill="none" vector-effect="non-scaling-stroke" points="2,2 8,8 2,14"></polyline></svg></label></div></div></li><li class="mv3"><input type="radio" name="carousel-4" id="carousel-4-1" class="o-0 absolute bottom-0 left-0"><div class="dn checked-reveal"><div class="aspect-ratio aspect-ratio--4x3"><img src="https://learnk8s.io/a/d7971470550de83a2a5f62630a76e244.svg" alt="The ethernet bridge, acting as a virtual switch, has to somehow resolve the destination pod IP (Pod-B) to its MAC address." class="aspect-ratio--object" loading="lazy"></div><div class="bt b-solid bw2 b--black-70 relative mt0"><div class="bg-black-10 br1 pa1 dib mt2 absolute bottom-1 left-0 z-999"><span class="b black-60">2</span><span class="f7 black-50">/5</span></div></div><div class="flex items-start justify-between bg-evian ph2"><label class="db f6 b black-50 pv3 pointer w-20 ttu" for="carousel-4-0"><svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon mr2"><polyline fill="none" vector-effect="non-scaling-stroke" points="8,2 2,8 8,14"></polyline></svg> Previous</label><div class="f5 lh-copy black-90 w-60 center"><p class="lh-copy measure-wide f5">The ethernet bridge, acting as a virtual switch, has to somehow resolve the destination pod IP (Pod-B) to its MAC address.</p></div><label class="db f6 b black-50 pv3 pointer w-20 tr ttu" for="carousel-4-2">Next <svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon ml2"><polyline fill="none" vector-effect="non-scaling-stroke" points="2,2 8,8 2,14"></polyline></svg></label></div></div></li><li class="mv3"><input type="radio" name="carousel-4" id="carousel-4-2" class="o-0 absolute bottom-0 left-0"><div class="dn checked-reveal"><div class="aspect-ratio aspect-ratio--4x3"><img src="https://learnk8s.io/a/41203cc004c803ef134a188150f70b51.svg" alt="The ARP protocol comes to the rescue. An ARP broadcast is sent on all connected devices when the frame reaches the bridge. The bridge shouts Who has Pod-B IP address?" class="aspect-ratio--object" loading="lazy"></div><div class="bt b-solid bw2 b--black-70 relative mt0"><div class="bg-black-10 br1 pa1 dib mt2 absolute bottom-1 left-0 z-999"><span class="b black-60">3</span><span class="f7 black-50">/5</span></div></div><div class="flex items-start justify-between bg-evian ph2"><label class="db f6 b black-50 pv3 pointer w-20 ttu" for="carousel-4-1"><svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon mr2"><polyline fill="none" vector-effect="non-scaling-stroke" points="8,2 2,8 8,14"></polyline></svg> Previous</label><div class="f5 lh-copy black-90 w-60 center"><p class="lh-copy measure-wide f5">The ARP protocol comes to the rescue. An ARP broadcast is sent on all connected devices when the frame reaches the bridge. The bridge shouts <em class="i">Who has Pod-B IP address?</em></p></div><label class="db f6 b black-50 pv3 pointer w-20 tr ttu" for="carousel-4-3">Next <svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon ml2"><polyline fill="none" vector-effect="non-scaling-stroke" points="2,2 8,8 2,14"></polyline></svg></label></div></div></li><li class="mv3"><input type="radio" name="carousel-4" id="carousel-4-3" class="o-0 absolute bottom-0 left-0"><div class="dn checked-reveal"><div class="aspect-ratio aspect-ratio--4x3"><img src="https://learnk8s.io/a/8b78c69458d16798e6feac8684f0a884.svg" alt="A reply is received with the MAC address of the interface that connects Pod-B, then this information is stored in the bridge ARP cache (lookup table)." class="aspect-ratio--object" loading="lazy"></div><div class="bt b-solid bw2 b--black-70 relative mt0"><div class="bg-black-10 br1 pa1 dib mt2 absolute bottom-1 left-0 z-999"><span class="b black-60">4</span><span class="f7 black-50">/5</span></div></div><div class="flex items-start justify-between bg-evian ph2"><label class="db f6 b black-50 pv3 pointer w-20 ttu" for="carousel-4-2"><svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon mr2"><polyline fill="none" vector-effect="non-scaling-stroke" points="8,2 2,8 8,14"></polyline></svg> Previous</label><div class="f5 lh-copy black-90 w-60 center"><p class="lh-copy measure-wide f5">A reply is received with the MAC address of the interface that connects Pod-B, then this information is stored in the bridge ARP cache (lookup table).</p></div><label class="db f6 b black-50 pv3 pointer w-20 tr ttu" for="carousel-4-4">Next <svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon ml2"><polyline fill="none" vector-effect="non-scaling-stroke" points="2,2 8,8 2,14"></polyline></svg></label></div></div></li><li class="mv3"><input type="radio" name="carousel-4" id="carousel-4-4" class="o-0 absolute bottom-0 left-0"><div class="dn checked-reveal"><div class="aspect-ratio aspect-ratio--4x3"><img src="https://learnk8s.io/a/a0a1c2ad1e4d390731827c0a8765297c.svg" alt="Once the mapping of the IP and MAC address is stored, the bridge looks up in the table and forwards the packet to the correct endpoint. The packet reaches Pod-B veth in the root namespace, and from there, it quickly reaches the eth0 interface inside the Pod-B namespace." class="aspect-ratio--object" loading="lazy"></div><div class="bt b-solid bw2 b--black-70 relative mt0"><div class="bg-black-10 br1 pa1 dib mt2 absolute bottom-1 left-0 z-999"><span class="b black-60">5</span><span class="f7 black-50">/5</span></div></div><div class="flex items-start justify-between bg-evian ph2"><label class="db f6 b black-50 pv3 pointer w-20 ttu" for="carousel-4-3"><svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon mr2"><polyline fill="none" vector-effect="non-scaling-stroke" points="8,2 2,8 8,14"></polyline></svg> Previous</label><div class="f5 lh-copy black-90 w-60 center"><p class="lh-copy measure-wide f5">Once the mapping of the IP and MAC address is stored, the bridge looks up in the table and forwards the packet to the correct endpoint. The packet reaches Pod-B <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">veth</code> in the root namespace, and from there, it quickly reaches the <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">eth0</code> interface inside the Pod-B namespace.</p></div><div class="w-20"></div></div></div></li></ul></div><p class="lh-copy measure-wide f4">With this, the communication between Pod-A and Pod-B has been successful.</p><h2 class="f2 pt5 pb2 mt3" id="tracing-pod-to-pod-communication-on-different-nodes">Tracing pod to pod communication on different nodes</h2><p class="lh-copy measure-wide f4">For pods that need to communicate across different nodes, an additional hop in the communication is required.</p><div class="relative overflow-hidden"><ul class="pl0 list"><li class="mv3"><input type="radio" name="carousel-5" id="carousel-5-0" checked="" class="o-0 absolute bottom-0 left-0"><div class="dn checked-reveal"><div class="aspect-ratio aspect-ratio--4x3"><img src="https://learnk8s.io/a/022dfe214001baf7b13aa0ffa2d33fd5.svg" alt="The first couple of steps stay the same, up to the point when the packet arrives in the root namespace and needs to be sent over to Pod-B." class="aspect-ratio--object" loading="lazy"></div><div class="bt b-solid bw2 b--black-70 relative mt0"><div class="bg-black-10 br1 pa1 dib mt2 absolute bottom-1 left-0 z-999"><span class="b black-60">1</span><span class="f7 black-50">/2</span></div></div><div class="flex items-start justify-between bg-evian ph2"><div class="w-20"></div><div class="f5 lh-copy black-90 w-60 center"><p class="lh-copy measure-wide f5">The first couple of steps stay the same, up to the point when the packet arrives in the root namespace and needs to be sent over to Pod-B.</p></div><label class="db f6 b black-50 pv3 pointer w-20 tr ttu" for="carousel-5-1">Next <svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon ml2"><polyline fill="none" vector-effect="non-scaling-stroke" points="2,2 8,8 2,14"></polyline></svg></label></div></div></li><li class="mv3"><input type="radio" name="carousel-5" id="carousel-5-1" class="o-0 absolute bottom-0 left-0"><div class="dn checked-reveal"><div class="aspect-ratio aspect-ratio--4x3"><img src="https://learnk8s.io/a/c0a1f670dab41e7dd4567494467ffe1a.svg" alt="When the destination IP is not in the local network, the packet is forwarded to the default gateway of that node. The exit or default gateway on the node is usually on the eth0 interface — the physical interface that connects the node to the network." class="aspect-ratio--object" loading="lazy"></div><div class="bt b-solid bw2 b--black-70 relative mt0"><div class="bg-black-10 br1 pa1 dib mt2 absolute bottom-1 left-0 z-999"><span class="b black-60">2</span><span class="f7 black-50">/2</span></div></div><div class="flex items-start justify-between bg-evian ph2"><label class="db f6 b black-50 pv3 pointer w-20 ttu" for="carousel-5-0"><svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon mr2"><polyline fill="none" vector-effect="non-scaling-stroke" points="8,2 2,8 8,14"></polyline></svg> Previous</label><div class="f5 lh-copy black-90 w-60 center"><p class="lh-copy measure-wide f5">When the destination IP is not in the local network, the packet is forwarded to the default gateway of that node. The exit or default gateway on the node is usually on the <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">eth0</code> interface — the physical interface that connects the node to the network.</p></div><div class="w-20"></div></div></div></li></ul></div><p class="lh-copy measure-wide f4"><strong class="b">This time, the ARP resolution doesn't happen because the source and the destination IP are on different networks.</strong></p><p class="lh-copy measure-wide f4">The check is done using a Bitwise operation.</p><p class="lh-copy measure-wide f4">When the destination IP is not on the current network, it is forwarded to the default gateway of the node.</p><h3 class="f3 pt3" id="how-the-bitwise-operation-works">How the Bitwise operation works</h3><p class="lh-copy measure-wide f4">The source node must perform a bitwise operation when determining where the packet should be forwarded.</p><p class="lh-copy measure-wide f4"><a href="https://en.wikipedia.org/wiki/Bitwise_operation#AND" target="_blank" rel="noreferrer" class="link navy underline hover-sky">This operation is also known as ANDing.</a></p><p class="lh-copy measure-wide f4">As a refresher, the bitwise AND operation yields the following:</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div></header><pre class="code-light-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="standard">0 AND 0 = 0
0 AND 1 = 0
1 AND 0 = 0
1 AND 1 = 1</span></code></pre></div><p class="lh-copy measure-wide f4">Anything apart from <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">1</code> and <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">1</code> will be false.</p><p class="lh-copy measure-wide f4">If the source node has an IP of 192.168.1.1 with a subnet mask of /24, and the destination IP is 172.16.1.1/16, the bitwise AND operation will state that they are indeed on different networks.</p><p class="lh-copy measure-wide f4">Meaning the destination IP isn't on the same network as the packet's source, so that the packet will be forwarded throughout the default gateway.</p><p class="lh-copy measure-wide f4"><em class="i">Math time.</em></p><p class="lh-copy measure-wide f4">We must start with the 32-bit addresses in binary to do the AND operation.</p><p class="lh-copy measure-wide f4">Let's first find out the source and destination IP networks.</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div></header><pre class="code-light-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="standard">| Type             | Binary                              | Converted          |
| ---------------- | ----------------------------------- | ------------------ |
| Src. IP Address  | 11000000.10101000.00000001.00000001 | 192.168.1.1        |
| Src. Subnet Mask | 11111111.11111111.11111111.00000000 | 255.255.255.0(/24) |
| Src. Network     | 11000000.10101000.00000001.00000000 | 192.168.1.0        |
|                  |                                     |                    |
| Dst. IP Address  | 10101100.00010000.00000001.00000001 | 172.16.1.1         |
| Dst. Subnet Mask | 11111111.11111111.00000000.00000000 | 255.255.0.0(/16)   |
| Dst. Network     | 10101100.00010000.00000000.00000000 | 172.16.0.0         |</span></code></pre></div><p class="lh-copy measure-wide f4">For the bitwise operation, you need to compare the destination IP to the source subnet of the node from where the packet originates.</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div></header><pre class="code-light-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="standard">| Type             | Binary                              | Converted          |
| ---------------- | ----------------------------------- | ------------------ |
| Dst. IP Address  | 10101100.00010000.00000001.00000001 | 172.16.1.1         |
| Src. Subnet Mask | 11111111.11111111.11111111.00000000 | 255.255.255.0(/24) |
| Network  Result  | 10101100.00010000.00000001.00000000 | 172.16.1.0         |</span></code></pre></div><p class="lh-copy measure-wide f4">As we can see, the ANDed network results in 172.16.1.0, which doesn't equal to 192.168.1.0 - the network from the source node.</p><p class="lh-copy measure-wide f4"><em class="i">With this, we confirm that the source and destination IP addresses don't reside on the same network.</em></p><p class="lh-copy measure-wide f4">For example, if the destination IP was 192.168.1.2, i.e. in the same subnet as the sending IP, the AND operation will yield the local network of the node.</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div></header><pre class="code-light-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="standard">| Type             | Binary                              | Converted          |
| ---------------- | ----------------------------------- | ------------------ |
| Dst. IP Address  | 11000000.10101000.00000001.00000010 | 192.168.1.2        |
| Src. Subnet Mask | 11111111.11111111.11111111.00000000 | 255.255.255.0(/24) |
| Network          | 11000000.10101000.00000001.00000000 | 192.168.1.0        |</span></code></pre></div><p class="lh-copy measure-wide f4">After the bitwise comparison is made, the ARP will check its lookup table for the MAC address of the default gateway.</p><p class="lh-copy measure-wide f4">If there is an entry, it will immediately forward the packet.</p><p class="lh-copy measure-wide f4">Otherwise, it will first do a broadcast to determine the MAC address of the gateway.</p><div class="relative overflow-hidden"><ul class="pl0 list"><li class="mv3"><input type="radio" name="carousel-6" id="carousel-6-0" checked="" class="o-0 absolute bottom-0 left-0"><div class="dn checked-reveal"><div class="aspect-ratio aspect-ratio--4x3"><img src="https://learnk8s.io/a/3a5b3956e2a3832304ac8cbe5aa9a822.svg" alt="The packet now is routed to the default interface of the other node. Let's call it Node-B." class="aspect-ratio--object" loading="lazy"></div><div class="bt b-solid bw2 b--black-70 relative mt0"><div class="bg-black-10 br1 pa1 dib mt2 absolute bottom-1 left-0 z-999"><span class="b black-60">1</span><span class="f7 black-50">/4</span></div></div><div class="flex items-start justify-between bg-evian ph2"><div class="w-20"></div><div class="f5 lh-copy black-90 w-60 center"><p class="lh-copy measure-wide f5">The packet now is routed to the default interface of the other node. Let's call it Node-B.</p></div><label class="db f6 b black-50 pv3 pointer w-20 tr ttu" for="carousel-6-1">Next <svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon ml2"><polyline fill="none" vector-effect="non-scaling-stroke" points="2,2 8,8 2,14"></polyline></svg></label></div></div></li><li class="mv3"><input type="radio" name="carousel-6" id="carousel-6-1" class="o-0 absolute bottom-0 left-0"><div class="dn checked-reveal"><div class="aspect-ratio aspect-ratio--4x3"><img src="https://learnk8s.io/a/10779bb42475660d288ff00c4866991f.svg" alt="In the reverse order. The packet is now at the root namespace of Node-B and reaches the bridge, where another ARP resolution will take place." class="aspect-ratio--object" loading="lazy"></div><div class="bt b-solid bw2 b--black-70 relative mt0"><div class="bg-black-10 br1 pa1 dib mt2 absolute bottom-1 left-0 z-999"><span class="b black-60">2</span><span class="f7 black-50">/4</span></div></div><div class="flex items-start justify-between bg-evian ph2"><label class="db f6 b black-50 pv3 pointer w-20 ttu" for="carousel-6-0"><svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon mr2"><polyline fill="none" vector-effect="non-scaling-stroke" points="8,2 2,8 8,14"></polyline></svg> Previous</label><div class="f5 lh-copy black-90 w-60 center"><p class="lh-copy measure-wide f5">In the reverse order. The packet is now at the root namespace of Node-B and reaches the bridge, where another ARP resolution will take place.</p></div><label class="db f6 b black-50 pv3 pointer w-20 tr ttu" for="carousel-6-2">Next <svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon ml2"><polyline fill="none" vector-effect="non-scaling-stroke" points="2,2 8,8 2,14"></polyline></svg></label></div></div></li><li class="mv3"><input type="radio" name="carousel-6" id="carousel-6-2" class="o-0 absolute bottom-0 left-0"><div class="dn checked-reveal"><div class="aspect-ratio aspect-ratio--4x3"><img src="https://learnk8s.io/a/0d1727622dcb07e25b7cc00bb590ced6.svg" alt="A reply is received with the MAC address of the interface that connects Pod-B." class="aspect-ratio--object" loading="lazy"></div><div class="bt b-solid bw2 b--black-70 relative mt0"><div class="bg-black-10 br1 pa1 dib mt2 absolute bottom-1 left-0 z-999"><span class="b black-60">3</span><span class="f7 black-50">/4</span></div></div><div class="flex items-start justify-between bg-evian ph2"><label class="db f6 b black-50 pv3 pointer w-20 ttu" for="carousel-6-1"><svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon mr2"><polyline fill="none" vector-effect="non-scaling-stroke" points="8,2 2,8 8,14"></polyline></svg> Previous</label><div class="f5 lh-copy black-90 w-60 center"><p class="lh-copy measure-wide f5">A reply is received with the MAC address of the interface that connects Pod-B.</p></div><label class="db f6 b black-50 pv3 pointer w-20 tr ttu" for="carousel-6-3">Next <svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon ml2"><polyline fill="none" vector-effect="non-scaling-stroke" points="2,2 8,8 2,14"></polyline></svg></label></div></div></li><li class="mv3"><input type="radio" name="carousel-6" id="carousel-6-3" class="o-0 absolute bottom-0 left-0"><div class="dn checked-reveal"><div class="aspect-ratio aspect-ratio--4x3"><img src="https://learnk8s.io/a/11aaf16ef5d875a4da148d3893dad165.svg" alt="This time the bridge forwards the frame through the Pod-B veth device, and it reaches Pod-B in its own namespace." class="aspect-ratio--object" loading="lazy"></div><div class="bt b-solid bw2 b--black-70 relative mt0"><div class="bg-black-10 br1 pa1 dib mt2 absolute bottom-1 left-0 z-999"><span class="b black-60">4</span><span class="f7 black-50">/4</span></div></div><div class="flex items-start justify-between bg-evian ph2"><label class="db f6 b black-50 pv3 pointer w-20 ttu" for="carousel-6-2"><svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon mr2"><polyline fill="none" vector-effect="non-scaling-stroke" points="8,2 2,8 8,14"></polyline></svg> Previous</label><div class="f5 lh-copy black-90 w-60 center"><p class="lh-copy measure-wide f5">This time the bridge forwards the frame through the Pod-B <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">veth</code> device, and it reaches Pod-B in its own namespace.</p></div><div class="w-20"></div></div></div></li></ul></div><p class="lh-copy measure-wide f4">Now that you are familiar with how the traffic flows between the pods let's take the time to explore how a CNI creates the above.</p><h2 class="f2 pt5 pb2 mt3" id="the-container-network-interface-cni">The Container Network Interface - CNI</h2><p class="lh-copy measure-wide f4"><a href="https://github.com/containernetworking/cni/blob/master/SPEC.md" target="_blank" rel="noreferrer" class="link navy underline hover-sky">The Container Network Interface (CNI) is concerned about the networking in the current node.</a></p><img class="db pv3 center" src="https://learnk8s.io/a/6c41c89fb22049f1eed5c0fb7b956bb2.svg" alt="The kubelet uses three interfaces: the Container Network Interface (CNI), the Container Runtime Interface (CRI) and the Container Storage Interface (CSI)" loading="lazy"><p class="lh-copy measure-wide f4"><strong class="b">You can think of the CNI as a set of rules that a networking plugin should follow to solve <em class="i">some</em> of the Kubernetes network requirements.</strong></p><p class="lh-copy measure-wide f4">However, this isn't tied only to Kubernetes or a specific network plugin.</p><p class="lh-copy measure-wide f4">You can use any CNI:</p><ul><li class="lh-copy f4 mv1 measure-wide"><a href="https://www.tigera.io/project-calico/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">Calico</a></li><li class="lh-copy f4 mv1 measure-wide"><a href="https://cilium.io/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">Cillium</a></li><li class="lh-copy f4 mv1 measure-wide"><a href="https://github.com/flannel-io/flannel" target="_blank" rel="noreferrer" class="link navy underline hover-sky">Flannel</a></li><li class="lh-copy f4 mv1 measure-wide"><a href="https://www.weave.works/docs/net/latest/overview/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">Weave Net</a></li><li class="lh-copy f4 mv1 measure-wide"><a href="https://github.com/containernetworking/cni#3rd-party-plugins" target="_blank" rel="noreferrer" class="link navy underline hover-sky">and a lot of other network plugins.</a></li></ul><p class="lh-copy measure-wide f4">They all implement the same CNI standard.</p><p class="lh-copy measure-wide f4">Without a CNI in place, you would need to manually:</p><ul><li class="lh-copy f4 mv1 measure-wide">Create interfaces.</li><li class="lh-copy f4 mv1 measure-wide">Create veth pairs.</li><li class="lh-copy f4 mv1 measure-wide">Set up the namespace networking.</li><li class="lh-copy f4 mv1 measure-wide">Set up static routes.</li><li class="lh-copy f4 mv1 measure-wide">Configure an ethernet bridge.</li><li class="lh-copy f4 mv1 measure-wide">Assign IP addresses.</li><li class="lh-copy f4 mv1 measure-wide">Create NAT rules.</li></ul><p class="lh-copy measure-wide f4">And a plethora of other things that will require excessive manual work.</p><p class="lh-copy measure-wide f4">Not to mention deleting or adjusting all of the above when a pod needs to be deleted or restarted.</p><p class="lh-copy measure-wide f4">The CNI must support <a href="https://github.com/containernetworking/cni/blob/master/SPEC.md#cni-operations" target="_blank" rel="noreferrer" class="link navy underline hover-sky">four distinct operations</a>:</p><ul><li class="lh-copy f4 mv1 measure-wide"><strong class="b">ADD</strong> - adds a container to the network.</li><li class="lh-copy f4 mv1 measure-wide"><strong class="b">DEL</strong> - deletes a container from the network.</li><li class="lh-copy f4 mv1 measure-wide"><strong class="b">CHECK</strong> - returns an error if there is a problem with the container's network.</li><li class="lh-copy f4 mv1 measure-wide"><strong class="b">VERSION</strong> - displays the version of the plugin.</li></ul><p class="lh-copy measure-wide f4"><em class="i">Let's see how it works in practice.</em></p><p class="lh-copy measure-wide f4">When a pod gets assigned to a specific node, the kubelet itself doesn't initialize the networking.</p><p class="lh-copy measure-wide f4">Instead, it offloads this task to the CNI.</p><p class="lh-copy measure-wide f4"><strong class="b">However, it does specify the configuration and sends it over in a JSON format to the CNI plugin.</strong></p><p class="lh-copy measure-wide f4">You can navigate to <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">/etc/cni/net.d</code> on the node and check the current CNI configuration file with:</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div><p class="code f6 mv0 black-60 w-100 tc absolute top-0 left-0 h1 pv2">bash</p></header><pre class="code-dark-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="command prompt"><span class="token function">cat</span> <span class="token number">10</span>-calico.conflist
</span><span class="output"><span class="token punctuation">{</span>
  <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"k8s-pod-network"</span>,
  <span class="token string">"cniVersion"</span><span class="token builtin class-name">:</span> <span class="token string">"0.3.1"</span>,
  <span class="token string">"plugins"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"calico"</span>,
      <span class="token string">"datastore_type"</span><span class="token builtin class-name">:</span> <span class="token string">"kubernetes"</span>,
      <span class="token string">"mtu"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
      <span class="token string">"nodename_file_optional"</span><span class="token builtin class-name">:</span> false,
      <span class="token string">"log_level"</span><span class="token builtin class-name">:</span> <span class="token string">"Info"</span>,
      <span class="token string">"log_file_path"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/log/calico/cni/cni.log"</span>,
      <span class="token string">"ipam"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"calico-ipam"</span>, <span class="token string">"assign_ipv4"</span> <span class="token builtin class-name">:</span> <span class="token string">"true"</span>, <span class="token string">"assign_ipv6"</span> <span class="token builtin class-name">:</span> <span class="token string">"false"</span><span class="token punctuation">}</span>,
      <span class="token string">"container_settings"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">"allow_ip_forwarding"</span><span class="token builtin class-name">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>,
      <span class="token string">"policy"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"k8s"</span>
      <span class="token punctuation">}</span>,
      <span class="token string">"kubernetes"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">"k8s_api_root"</span><span class="token builtin class-name">:</span><span class="token string">"https://10.96.0.1:443"</span>,
          <span class="token string">"kubeconfig"</span><span class="token builtin class-name">:</span> <span class="token string">"/etc/cni/net.d/calico-kubeconfig"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>,
    <span class="token punctuation">{</span>
      <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"bandwidth"</span>,
      <span class="token string">"capabilities"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">"bandwidth"</span><span class="token builtin class-name">:</span> true<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>,
    <span class="token punctuation">{</span><span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"portmap"</span>, <span class="token string">"snat"</span><span class="token builtin class-name">:</span> true, <span class="token string">"capabilities"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">"portMappings"</span><span class="token builtin class-name">:</span> true<span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></span><span class="output prompt mt3 empty"></span></code></pre></div><p class="lh-copy measure-wide f4"><strong class="b">Each CNI plugin uses a different type of configuration for the network setup.</strong></p><p class="lh-copy measure-wide f4">For example, Calico uses layer 3 networking paired with the BGP routing protocol to connect pods.</p><p class="lh-copy measure-wide f4">Cilium configures an overlay network with eBPF on layers 3 to 7.</p><p class="lh-copy measure-wide f4">Along with Calico, Cilium supports setting up network policies to restrict traffic.</p><p class="lh-copy measure-wide f4"><em class="i">So which one should you use?</em></p><p class="lh-copy measure-wide f4">It depends.</p><p class="lh-copy measure-wide f4">There are mainly two groups of CNIs.</p><p class="lh-copy measure-wide f4"><strong class="b">In the first group, you can find CNIs that use a basic network setup (also called a flat network)</strong> and assign IP addresses to pods from the cluster's IP pool.</p><p class="lh-copy measure-wide f4">This could become a burden as you might quickly exhaust all available IP addresses.</p><p class="lh-copy measure-wide f4"><strong class="b">Instead, another approach is to use overlay networking.</strong></p><p class="lh-copy measure-wide f4">In simple terms, an overlay network is a secondary network on top of the main (underlay) network.</p><p class="lh-copy measure-wide f4"><strong class="b">The overlay network works by encapsulating any packet originating from the underlay network that is destined to a pod on another node.</strong></p><p class="lh-copy measure-wide f4">A popular technology for overlay networks is <a href="https://iximiuz.com/en/posts/computer-networking-101/" target="_blank" rel="noreferrer" class="link navy underline hover-sky">VXLAN</a>, which enables tunnelling L2 domains over an L3 network.</p><p class="lh-copy measure-wide f4"><em class="i">So which one is better?</em></p><p class="lh-copy measure-wide f4"><strong class="b">There isn't a single answer, and it usually comes down to your requirements.</strong></p><p class="lh-copy measure-wide f4"><em class="i">Are you building a large cluster with tens of thousands of nodes?</em></p><p class="lh-copy measure-wide f4">Maybe an overlay is better.</p><p class="lh-copy measure-wide f4"><em class="i">Do you value a simpler setup and the ability to inspect your network traffic without being lost in nested networks?</em></p><p class="lh-copy measure-wide f4">A flat network is perfect for you.</p><p class="lh-copy measure-wide f4">Now that we've discussed the CNI let's explore how Pod-to-Service communication works.</p><h2 class="f2 pt5 pb2 mt3" id="inspecting-pod-to-service-traffic">Inspecting Pod to Service traffic</h2><p class="lh-copy measure-wide f4">Due to the dynamic nature of the pods in Kubernetes environments, the IP addresses that are assigned to them aren't static.</p><p class="lh-copy measure-wide f4"><strong class="b">They are ephemeral and change every time a pod is created or deleted.</strong></p><p class="lh-copy measure-wide f4">The service addresses this issue and provides a stable mechanism for connecting to a set of pods.</p><img class="db pv3 center" src="https://learnk8s.io/a/cadd4ed0c39fc22f77a6278bacd832a2.svg" alt="A service provides a stable mechanism for connecting to a set of pods." loading="lazy"><p class="lh-copy measure-wide f4">By default, when you create a service in Kubernetes, <a href="https://kubernetes.io/docs/concepts/services-networking/service/#virtual-ips-and-service-proxies" target="_blank" rel="noreferrer" class="link navy underline hover-sky">a virtual IP is reserved and assigned to it.</a></p><p class="lh-copy measure-wide f4">From there, using selectors, you associate the service to the target pods.</p><p class="lh-copy measure-wide f4"><em class="i">What happens when a pod is deleted, and a new one is added?</em></p><p class="lh-copy measure-wide f4"><strong class="b">The service's virtual IP remains static and unchanged.</strong></p><p class="lh-copy measure-wide f4">However, the traffic will reach the newly created pods without the need for intervention.</p><p class="lh-copy measure-wide f4">In other words, services in Kubernetes are similar to load balancers.</p><p class="lh-copy measure-wide f4"><em class="i">But how do they work?</em></p><h2 class="f2 pt5 pb2 mt3" id="intercepting-and-rewriting-traffic-with-netfilter-and-iptables">Intercepting and rewriting traffic with Netfilter and Iptables</h2><p class="lh-copy measure-wide f4">The service in Kubernetes is built upon two Linux kernel components:</p><ol><li class="lh-copy f4 mv1 measure-wide"><a href="https://en.wikipedia.org/wiki/Netfilter" target="_blank" rel="noreferrer" class="link navy underline hover-sky">Netfilter</a> and</li><li class="lh-copy f4 mv1 measure-wide"><a href="https://en.wikipedia.org/wiki/Iptables" target="_blank" rel="noreferrer" class="link navy underline hover-sky">iptables</a>.</li></ol><p class="lh-copy measure-wide f4"><strong class="b">Netfilter is a framework that allows to configure packet filtering, create NAT or port translation rules, and manage the traffic flow in the network.</strong></p><p class="lh-copy measure-wide f4">In addition, it also shields and prevents unsolicited connections to reach the services.</p><p class="lh-copy measure-wide f4"><strong class="b">Iptables, on the other hand, is a user-space utility program that allows you to configure the IP packet filter rules of the Linux kernel firewall.</strong></p><p class="lh-copy measure-wide f4">The iptables are implemented as different Netfilter modules.</p><p class="lh-copy measure-wide f4">You use the iptables CLI to alter the filtering rules on the fly and insert them into netfilters hooking points.</p><p class="lh-copy measure-wide f4">The filters are organized in different tables, which contain chains for handling network traffic packets.</p><p class="lh-copy measure-wide f4">Different kernel modules and programs are used for each protocol.</p><blockquote class="pl3 mh2 bl bw2 b--blue bg-evian pv1 ph4"><p class="lh-copy measure-wide f4">When iptables is mentioned, it generally means the usage is for IPv4. For IPv6 rules, the CLI is called ip6tables.</p></blockquote><p class="lh-copy measure-wide f4">Iptables has five types of chains, and each chain directly maps to the Netfilter's hooks.</p><p class="lh-copy measure-wide f4">From iptables point of view, they are:</p><ul><li class="lh-copy f4 mv1 measure-wide"><code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">PRE_ROUTING</code></li><li class="lh-copy f4 mv1 measure-wide"><code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">INPUT</code></li><li class="lh-copy f4 mv1 measure-wide"><code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">FORWARD</code></li><li class="lh-copy f4 mv1 measure-wide"><code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">OUTPUT</code></li><li class="lh-copy f4 mv1 measure-wide"><code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">POST_ROUTING</code></li></ul><p class="lh-copy measure-wide f4">And they correspondingly map to Netfilter hooks:</p><ul><li class="lh-copy f4 mv1 measure-wide"><code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">NF_IP_PRE_ROUTING</code></li><li class="lh-copy f4 mv1 measure-wide"><code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">NF_IP_LOCAL_IN</code></li><li class="lh-copy f4 mv1 measure-wide"><code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">NF_IP_FORWARD</code></li><li class="lh-copy f4 mv1 measure-wide"><code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">NF_IP_LOCAL_OUT</code></li><li class="lh-copy f4 mv1 measure-wide"><code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">NF_IP_POST_ROUTING</code></li></ul><p class="lh-copy measure-wide f4">When a packet arrives, and depending on which stage it is, it will 'trigger' a Netfilter hook, which applies a specific iptables filtering.</p><img class="db pv3 center" src="https://learnk8s.io/a/2bcc5217ed5543a0e22c595485f014be.svg" alt="IPtable filtering" loading="lazy"><p class="lh-copy measure-wide f4"><em class="i">Yikes! That looks complex!</em></p><p class="lh-copy measure-wide f4">Nothing to worry though.</p><p class="lh-copy measure-wide f4">That's why we use Kubernetes, all of the above is abstracted through the use of services, and a simple YAML definition sets those rules automatically.</p><p class="lh-copy measure-wide f4">If you are interested in seeing the iptables rules, you can connect to a node and run:</p><div class="mv4 mv5-l"><header class="bg-light-gray flex pv2 pl1 br--top br2 relative"><div class="w1 h1 ml1 br-100 bg-dark-red"></div><div class="w1 h1 ml1 br-100 bg-green"></div><div class="w1 h1 ml1 br-100 bg-yellow"></div><p class="code f6 mv0 black-60 w-100 tc absolute top-0 left-0 h1 pv2">bash</p></header><pre class="code-dark-theme relative overflow-auto mv0 br2 br--bottom"><code class="code lh-copy"><span class="command prompt active">iptables-save</span></code></pre></div><p class="lh-copy measure-wide f4">You can also <a href="https://github.com/Nudin/iptable_vis" target="_blank" rel="noreferrer" class="link navy underline hover-sky">use this tool to visualize</a> the iptables chains on a node.</p><p class="lh-copy measure-wide f4">Example diagram with visualized iptables chains, taken from a GKE node:</p><a href="https://svgshare.com/i/bgz.svg" target="_blank" rel="noreferrer" class="link navy underline hover-sky db"><img class="db pv3 center" src="https://learnk8s.io/a/34074233db1f1941c17bd5abd5ff2744.svg" alt="The iptables rules visualised for a GKE cluster" loading="lazy"></a><p class="lh-copy measure-wide f4"><em class="i">Keep in mind that there may be hundreds of rules configured. Imagine creating them by hand!</em></p><p class="lh-copy measure-wide f4">We have explained how Pod-to-Pod communication happens when pods are on the same and different nodes.</p><p class="lh-copy measure-wide f4">In Pod-to-Service, the first half of the communication stays the same.</p><img class="db pv3 center" src="https://learnk8s.io/a/167545f614324841b5bcd3713df08485.svg" alt="In Pod-to-Service, the first half of the communication stays the same." loading="lazy"><p class="lh-copy measure-wide f4">When the request starts at Pod-A, and it wants to reach Pod-B, which in this case will be 'behind' a service, there is an additional change happening halfway through the transfer.</p><p class="lh-copy measure-wide f4">The originating request exits through the <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">eth0</code> interface in the Pod-A namespace.</p><p class="lh-copy measure-wide f4">From there, it goes through the <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">veth</code> pair and reaches the root namespace ethernet bridge.</p><p class="lh-copy measure-wide f4">Once at the bridge, the packet gets immediately forwarded through the default gateway.</p><p class="lh-copy measure-wide f4">As in the Pod-to-Pod section, the host makes a bitwise comparison, and because the vIP of the service isn't part of the node's CIDR, the packet will be instantly forwarded through the default gateway.</p><p class="lh-copy measure-wide f4">The same ARP resolution will happen to find out the MAC address of the default gateway if it isn't already present in the lookup table.</p><p class="lh-copy measure-wide f4"><em class="i">Now the magic happens.</em></p><p class="lh-copy measure-wide f4">Just before that packet goes through the routing process of the node, the <code class="code f5 lh-copy bg-near-white br2 pv1 ph2 fs-normal word-wrap">NF_IP_PRE_ROUTING</code> Netfilter hook gets triggered, and an iptables rule is applied. The rule does a DNAT change and rewrites Pod's A packet destination IP.</p><img class="db pv3 center" src="https://learnk8s.io/a/9fa0ef7eaf2ffc332d0cb9e6b4ba5c3a.svg" alt="The packet is intercepted by the iptables rules and rewritten." loading="lazy"><p class="lh-copy measure-wide f4">The previous service vIP destination gets rewritten to the Pod's B IP address.</p><p class="lh-copy measure-wide f4">From there, the routing is just as same as directly communicating Pod-to-Pod.</p><img class="db pv3 center" src="https://learnk8s.io/a/99423166613c21cff6aaa50c7590ff40.svg" alt="After the packet is rewritten, the communication is pod to pod." loading="lazy"><p class="lh-copy measure-wide f4">However, in between all this communication, another third feature is utilized.</p><p class="lh-copy measure-wide f4"><a href="https://www.linuxtopia.org/Linux_Firewall_iptables/x1298.html" target="_blank" rel="noreferrer" class="link navy underline hover-sky">This feature is called conntrack</a>, or connection tracking.</p><p class="lh-copy measure-wide f4"><strong class="b">Conntrack will associate the packet to the connection and keep track of its origin when a response is sent back by Pod-B.</strong></p><p class="lh-copy measure-wide f4">The NAT heavily relies on conntrack to work.</p><p class="lh-copy measure-wide f4">Without connection tracking, it wouldn't know where to send back the packet containing the response.</p><p class="lh-copy measure-wide f4">When conntrack is used, the return path of the packets is easily set up with the same source or destination NAT change.</p><p class="lh-copy measure-wide f4">The other half is now in the reverse order.</p><p class="lh-copy measure-wide f4">Pod-B received and processed the request and now sends back data to Pod-A.</p><p class="lh-copy measure-wide f4"><em class="i">What happens now?</em></p><h2 class="f2 pt5 pb2 mt3" id="inspecting-responses-from-services">Inspecting responses from Services</h2><p class="lh-copy measure-wide f4">Now Pod-B sends the response, setting up its IP address as source and Pod's A IP address as the destination.</p><div class="relative overflow-hidden"><ul class="pl0 list"><li class="mv3"><input type="radio" name="carousel-7" id="carousel-7-0" checked="" class="o-0 absolute bottom-0 left-0"><div class="dn checked-reveal"><div class="aspect-ratio aspect-ratio--4x3"><img src="https://learnk8s.io/a/1fb95f23de623640b7f760720dfc6a2c.svg" alt="When the packet reaches the interface at the node, where Pod-A is located, another NAT happens." class="aspect-ratio--object" loading="lazy"></div><div class="bt b-solid bw2 b--black-70 relative mt0"><div class="bg-black-10 br1 pa1 dib mt2 absolute bottom-1 left-0 z-999"><span class="b black-60">1</span><span class="f7 black-50">/3</span></div></div><div class="flex items-start justify-between bg-evian ph2"><div class="w-20"></div><div class="f5 lh-copy black-90 w-60 center"><p class="lh-copy measure-wide f5">When the packet reaches the interface at the node, where Pod-A is located, another NAT happens.</p></div><label class="db f6 b black-50 pv3 pointer w-20 tr ttu" for="carousel-7-1">Next <svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon ml2"><polyline fill="none" vector-effect="non-scaling-stroke" points="2,2 8,8 2,14"></polyline></svg></label></div></div></li><li class="mv3"><input type="radio" name="carousel-7" id="carousel-7-1" class="o-0 absolute bottom-0 left-0"><div class="dn checked-reveal"><div class="aspect-ratio aspect-ratio--4x3"><img src="https://learnk8s.io/a/3b45bb633564d9d7dc2fbe3f7f3e401a.svg" alt="This time, using conntrack, the source IP address changes, the iptables rule does a SNAT, and swaps Pod's B source IP to the vIP of the original service." class="aspect-ratio--object" loading="lazy"></div><div class="bt b-solid bw2 b--black-70 relative mt0"><div class="bg-black-10 br1 pa1 dib mt2 absolute bottom-1 left-0 z-999"><span class="b black-60">2</span><span class="f7 black-50">/3</span></div></div><div class="flex items-start justify-between bg-evian ph2"><label class="db f6 b black-50 pv3 pointer w-20 ttu" for="carousel-7-0"><svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon mr2"><polyline fill="none" vector-effect="non-scaling-stroke" points="8,2 2,8 8,14"></polyline></svg> Previous</label><div class="f5 lh-copy black-90 w-60 center"><p class="lh-copy measure-wide f5">This time, using conntrack, the source IP address changes, the iptables rule does a SNAT, and swaps Pod's B source IP to the vIP of the original service.</p></div><label class="db f6 b black-50 pv3 pointer w-20 tr ttu" for="carousel-7-2">Next <svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon ml2"><polyline fill="none" vector-effect="non-scaling-stroke" points="2,2 8,8 2,14"></polyline></svg></label></div></div></li><li class="mv3"><input type="radio" name="carousel-7" id="carousel-7-2" class="o-0 absolute bottom-0 left-0"><div class="dn checked-reveal"><div class="aspect-ratio aspect-ratio--4x3"><img src="https://learnk8s.io/a/e1d8746cc8f43e0589a7a95c19fe500e.svg" alt="For Pod-A, this looks as if the incoming response originates from the service and not Pod-B." class="aspect-ratio--object" loading="lazy"></div><div class="bt b-solid bw2 b--black-70 relative mt0"><div class="bg-black-10 br1 pa1 dib mt2 absolute bottom-1 left-0 z-999"><span class="b black-60">3</span><span class="f7 black-50">/3</span></div></div><div class="flex items-start justify-between bg-evian ph2"><label class="db f6 b black-50 pv3 pointer w-20 ttu" for="carousel-7-1"><svg viewBox="0 0 10 16" xmlns="http://www.w3.org/2000/svg" class="pagination-icon mr2"><polyline fill="none" vector-effect="non-scaling-stroke" points="8,2 2,8 8,14"></polyline></svg> Previous</label><div class="f5 lh-copy black-90 w-60 center"><p class="lh-copy measure-wide f5">For Pod-A, this looks as if the incoming response originates from the service and not Pod-B.</p></div><div class="w-20"></div></div></div></li></ul></div><p class="lh-copy measure-wide f4">The rest is the same; once the SNAT is done, the packet reaches the ethernet bridge in the root namespace and gets forwarded through the veth pair to Pod-A.</p><h2 class="f2 pt5 pb2 mt3" id="recap">Recap</h2><p class="lh-copy measure-wide f4">Let's do a recap on what you've learned in this article:</p><ul><li class="lh-copy f4 mv1 measure-wide">How containers talk locally or Intra-Pod communication.</li><li class="lh-copy f4 mv1 measure-wide">Pod-to-Pod communication when the pods are on the same and different nodes.</li><li class="lh-copy f4 mv1 measure-wide">Pod-to-Service - when pod sends traffic to another pod behind a service in Kubernetes.</li><li class="lh-copy f4 mv1 measure-wide">What are namespaces, veth, iptables, chains, conntrack, Netfilter, CNIs, overlay networks, and everything else in the Kubernetes networking toolbox required for effective communication.</li></ul><div class="mv4 mv5-l"><p class="f2 navy b mt0 measure-narrow">Don't miss the next article!</p><p class="f4 measure black-80 mv4 lh-copy">Be the first to be notified when a new article or Kubernetes experiment is published.</p><form class="subscribe-form" method="POST" action="/subscribe"><input type="hidden" name="hp"><input type="hidden" name="referrer" value="/kubernetes-network-packets"><div class="mv4"><div class="mv3"><label for="email" class="dib v-btm f4 measure black-80">Your email address: </label><span class="dib bb ml2"><input class="pa2 input-reset b--none" type="email" autocapitalize="off" autocorrect="off" name="email" id="email" size="25" value="" placeholder="kubernetes@gmail.com"></span></div></div><div class="js-success mv4 dn"><p class="bg-light-green ba b--green black-80 pa2 bw1 br2 mv0 b flex items-center"><svg viewBox="0 0 30 30" xmlns="http://www.w3.org/2000/svg" class="w1 pr2"><g fill="none" fill-rule="evenodd"><circle fill="#EEECF5" cx="15" cy="15" r="15"></circle><circle fill="#FFF" cx="15" cy="15" r="12.188"></circle><circle fill="#3BDBB8" cx="15" cy="15" r="15"></circle><path d="M22.103 11.844c0 .23-.092.46-.257.626l-7.917 7.917a.893.893 0 01-1.252 0l-4.585-4.585a.893.893 0 010-1.252l1.252-1.25a.893.893 0 011.252 0l2.708 2.714 6.039-6.048a.893.893 0 011.25 0l1.252 1.252c.166.166.26.396.26.625l-.002.001z" fill="#FFF"></path></g></svg> You are in!</p></div><div class="dib bg-azure-8 bb bw2 b--azure-4 mv2 pa1 br2 hover-bg-azure-7 pointer"><button class="db bn bg-transparent pa0 pointer" name="submit"><span class="db brown-0 ph3 pv2 b f5 ba b--azure-4 tc">Subscribe</span></button></div></form><p class="f6 black-60 mt4 mb0 underline">*We'll never share your email address, and you can opt-out at any time.</p></div></article>

				<div class="tag-option mt-5 clearfix">
				    <ul class="float-left list-inline"> 
				    	<li>Tags:</li> 
				    	<li class="list-inline-item"><a href="#" rel="tag">Advancher</a></li>
				    	<li class="list-inline-item"><a href="#" rel="tag">Landscape</a></li>
				    	<li class="list-inline-item"><a href="#" rel="tag">Travel</a></li>
				   	</ul>        

				    <ul class="float-right list-inline">
				        <li class="list-inline-item"> Share: </li>
				        <li class="list-inline-item"><a href="#" target="_blank"><i class="fab fa-facebook-f" aria-hidden="true"></i></a></li>
				        <li class="list-inline-item"><a href="#" target="_blank"><i class="fab fa-twitter" aria-hidden="true"></i></a></li>
				        <li class="list-inline-item"><a href="#" target="_blank"><i class="fab fa-pinterest-p" aria-hidden="true"></i></a></li>
				        <li class="list-inline-item"><a href="#" target="_blank"><i class="fab fa-google-plus" aria-hidden="true"></i></a></li>
				    </ul>
			    </div>
			</div>
		</div>
	</div>


	<div class="col-lg-12 mb-5">
		<div class="posts-nav bg-white p-5 d-lg-flex d-md-flex justify-content-between ">
			<a class="post-prev align-items-center" href="#">
				<div class="posts-prev-item mb-4 mb-lg-0">
					<span class="nav-posts-desc text-color">- Previous Post</span>
					<h6 class="nav-posts-title mt-1">
						Donec consectetuer ligula <br>vulputate sem tristique.
					</h6>
				</div>
			</a>
			<div class="border"></div>
			<a class="posts-next" href="#">
				<div class="posts-next-item pt-4 pt-lg-0">
					<span class="nav-posts-desc text-lg-right text-md-right text-color d-block">- Next Post</span>
					<h6 class="nav-posts-title mt-1">
						Ut aliquam sollicitudin leo.
					</h6>
				</div>
			</a>
		</div>
	</div>

	<div class="col-lg-12 mb-5">
		<div class="comment-area card border-0 p-5">
			<h4 class="mb-4">2 Comments</h4>
			<ul class="comment-tree list-unstyled">
				<li class="mb-5">
					<div class="comment-area-box">
						<img alt="" src="images/blog/test1.jpg" class="img-fluid float-left mr-3 mt-2">

						<h5 class="mb-1">Philip W</h5>
						<span>United Kingdom</span>

						<div class="comment-meta mt-4 mt-lg-0 mt-md-0 float-lg-right float-md-right">
							<a href="#"><i class="icofont-reply mr-2 text-muted"></i>Reply |</a>
							<span class="date-comm">Posted October 7, 2018 </span>
						</div>

						<div class="comment-content mt-3">
							<p>Some consultants are employed indirectly by the client via a consultancy staffing company, a company that provides consultants on an agency basis. </p>
						</div>
					</div>
				</li>

				<li>
					<div class="comment-area-box">
						<img alt="" src="images/blog/test2.jpg" class="mt-2 img-fluid float-left mr-3">

						<h5 class="mb-1">Philip W</h5>
						<span>United Kingdom</span>

						<div class="comment-meta mt-4 mt-lg-0 mt-md-0 float-lg-right float-md-right">
							<a href="#"><i class="icofont-reply mr-2 text-muted"></i>Reply |</a>
							<span class="date-comm">Posted October 7, 2018</span>
						</div>

						<div class="comment-content mt-3">
							<p>Some consultants are employed indirectly by the client via a consultancy staffing company, a company that provides consultants on an agency basis. </p>
						</div>
					</div>
				</li>
			</ul>
		</div>
	</div>

	<div class="col-lg-12">
		<form class="contact-form bg-white rounded p-5" id="comment-form">
			<h4 class="mb-4">Write a comment</h4>
			<div class="row">
				<div class="col-md-6">
					<div class="form-group">
						<input class="form-control" type="text" name="name" id="name" placeholder="Name:">
					</div>
				</div>
				<div class="col-md-6">
					<div class="form-group">
						<input class="form-control" type="text" name="mail" id="mail" placeholder="Email:">
					</div>
				</div>
			</div>


			<textarea class="form-control mb-3" name="comment" id="comment" cols="30" rows="5" placeholder="Comment"></textarea>

			<input class="btn btn-main btn-round-full" type="submit" name="submit-contact" id="submit_contact" value="Submit Message">
		</form>
	</div>
</div>
            </div>
            <div class="col-lg-4">
                <div class="sidebar-wrap">
	<div class="sidebar-widget search card p-4 mb-3 border-0">
		<input type="text" class="form-control" placeholder="search">
		<a href="#" class="btn btn-mian btn-small d-block mt-2">search</a>
	</div>

	<div class="sidebar-widget card border-0 mb-3">
		<img src="images/blog/blog-author.jpg" alt="" class="img-fluid">
		<div class="card-body p-4 text-center">
			<h5 class="mb-0 mt-4">Arther Conal</h5>
			<p>Digital Marketer</p>
			<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Incidunt, dolore.</p>

			<ul class="list-inline author-socials">
				<li class="list-inline-item mr-3">
					<a href="#"><i class="fab fa-facebook-f text-muted"></i></a>
				</li>
				<li class="list-inline-item mr-3">
					<a href="#"><i class="fab fa-twitter text-muted"></i></a>
				</li>
				<li class="list-inline-item mr-3">
					<a href="#"><i class="fab fa-linkedin-in text-muted"></i></a>
				</li>
				<li class="list-inline-item mr-3">
					<a href="#"><i class="fab fa-pinterest text-muted"></i></a>
				</li>
				<li class="list-inline-item mr-3">
					<a href="#"><i class="fab fa-behance text-muted"></i></a>
				</li>
			</ul>
		</div>
	</div>

	<div class="sidebar-widget latest-post card border-0 p-4 mb-3">
		<h5>Latest Posts</h5>

        <div class="media border-bottom py-3">
            <a href="#"><img class="mr-4" src="images/blog/bt-3.jpg" alt=""></a>
            <div class="media-body">
                <h6 class="my-2"><a href="#">Thoughtful living in los Angeles</a></h6>
                <span class="text-sm text-muted">03 Mar 2018</span>
            </div>
        </div>

        <div class="media border-bottom py-3">
            <a href="#"><img class="mr-4" src="images/blog/bt-2.jpg" alt=""></a>
           <div class="media-body">
                <h6 class="my-2"><a href="#">Vivamus molestie gravida turpis.</a></h6>
                <span class="text-sm text-muted">03 Mar 2018</span>
            </div>
        </div>

        <div class="media py-3">
            <a href="#"><img class="mr-4" src="images/blog/bt-1.jpg" alt=""></a>
            <div class="media-body">
                <h6 class="my-2"><a href="#">Fusce lobortis lorem at ipsum semper sagittis</a></h6>
                <span class="text-sm text-muted">03 Mar 2018</span>
            </div>
        </div>
	</div>

	<div class="sidebar-widget bg-white rounded tags p-4 mb-3">
		<h5 class="mb-4">Tags</h5>

		<a href="#">Web</a>
		<a href="#">agency</a>
		<a href="#">company</a>
		<a href="#">creative</a>
		<a href="#">html</a>
		<a href="#">Marketing</a>
		<a href="#">Social Media</a>
		<a href="#">Branding</a>
	</div>
</div>
            </div>   
        </div>
    </div>
</section>


<!-- footer Start -->
<footer class="footer section">
	<div class="container">
		<div class="row">
			<div class="col-lg-3 col-md-6 col-sm-6">
				<div class="widget">
					<h4 class="text-capitalize mb-4">Company</h4>

					<ul class="list-unstyled footer-menu lh-35">
						<li><a href="#">Terms & Conditions</a></li>
						<li><a href="#">Privacy Policy</a></li>
						<li><a href="#">Support</a></li>
						<li><a href="#">FAQ</a></li>
					</ul>
				</div>
			</div>
			<div class="col-lg-2 col-md-6 col-sm-6">
				<div class="widget">
					<h4 class="text-capitalize mb-4">Quick Links</h4>

					<ul class="list-unstyled footer-menu lh-35">
						<li><a href="#">About</a></li>
						<li><a href="#">Services</a></li>
						<li><a href="#">Team</a></li>
						<li><a href="#">Contact</a></li>
					</ul>
				</div>
			</div>


			<div class="col-lg-3 ml-auto col-sm-6">
				<div class="widget">
					<div class="logo mb-4">
						<h3>Desk9 Solutions</h3>
					</div>
					<h6><a href="tel:+23-345-67890" >Support@desk9solutions.com</a></h6>
					<a href="mailto:support@gmail.com"><span class="text-color h4">+23-456-6588</span></a>
				</div>
			</div>
		</div>
		

	</div>
</footer>
   
    </div>

    <!-- 
    Essential Scripts
    =====================================-->

    
    <!-- Main jQuery -->
    <script src="plugins/jquery/jquery.js"></script>
    <script src="js/contact.js"></script>
    <!-- Bootstrap 4.3.1 -->
    <script src="plugins/bootstrap/js/popper.js"></script>
    <script src="plugins/bootstrap/js/bootstrap.min.js"></script>
   <!--  Magnific Popup-->
    <script src="plugins/magnific-popup/dist/jquery.magnific-popup.min.js"></script>
    <!-- Slick Slider -->
    <script src="plugins/slick-carousel/slick/slick.min.js"></script>
    <!-- Counterup -->
    <script src="plugins/counterup/jquery.waypoints.min.js"></script>
    <script src="plugins/counterup/jquery.counterup.min.js"></script>

    <!-- Google Map -->
    <script src="plugins/google-map/map.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAkeLMlsiwzp6b3Gnaxd86lvakimwGA6UA&callback=initMap"></script>    
    
    <script src="js/script.js"></script>

  </body>
  </html>
